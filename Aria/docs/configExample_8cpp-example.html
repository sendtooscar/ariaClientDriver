<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Aria: configExample.cpp</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="classes.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>configExample.cpp</h1>Example program demonstrating the use of <a class="el" href="classArConfig.html" title="Stores configuration information which may be read to and from files or other sources...">ArConfig</a><p>
This program shows how to use <a class="el" href="classArConfig.html" title="Stores configuration information which may be read to and from files or other sources...">ArConfig</a> to store configuration parameters and load/save them from a file.<p>
The ArNetworking library includes server classes that will let you use a remote client such as MobileEyes to view and change the configuration. See ArNetworking documentation and examples.<p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include "Aria.h"</span>

<span class="keyword">class </span>ConfigExample
{
  <a name="_a0"></a><a class="code" href="classArConfig.html" title="Stores configuration information which may be read to and from files or other sources...">ArConfig</a>* myConfig;
  <span class="keywordtype">int</span> myIntParam;
  <span class="keywordtype">double</span> myDoubleParam;
  <span class="keywordtype">bool</span> myBoolParam;
  <span class="keywordtype">char</span> myStringParam[256];
  <a name="_a1"></a><a class="code" href="classArRetFunctorC.html" title="Functor for a member function with return value.">ArRetFunctorC&lt;bool, ConfigExample&gt;</a> myProcessConfigCB;

<span class="keyword">public</span>:
  ConfigExample():
    myIntParam(0),
    myDoubleParam(0.5),
    myBoolParam(<span class="keyword">false</span>),
    myProcessConfigCB(<span class="keyword">this</span>, &amp;ConfigExample::processConfigFile)
  {
    <span class="comment">// The global Aria class contains an ArConfig object.  You can create</span>
    <span class="comment">// other instances of ArConfig, but this is how you can share one ArConfig</span>
    <span class="comment">// among various program modules.</span>
    <span class="comment">// If you want to store a config parameter in ArConfig, first you must add </span>
    <span class="comment">// it to the ArConfig object.  Parameters are stored in sections, and</span>
    <span class="comment">// they affect a variable via a pointer provided in an ArConfigArg</span>
    <span class="comment">// object:</span>
    <a class="code" href="classArConfig.html" title="Stores configuration information which may be read to and from files or other sources...">ArConfig</a>* config = <a name="a2"></a><a class="code" href="classAria.html#ce50b4190f04bcacaf285bb5830c5fc2" title="Gets the ArConfig for this program.">Aria::getConfig</a>();
    config-&gt;<a name="a3"></a><a class="code" href="classArConfig.html#f464029663cdae8d46c20ad96536c801" title="Sets the comment for a section.">setSectionComment</a>(<span class="stringliteral">"Example Section"</span>, <span class="stringliteral">"Contains parameters created by the configExample"</span>);

    <span class="comment">// Add an integer which ranges from -10 to 10:</span>
    config-&gt;<a name="a4"></a><a class="code" href="classArConfig.html#c8c17f43d6e597f660cad0c180c8ab0b" title="Command to add a parameter to the given section with given priority.">addParam</a>( <a name="_a5"></a><a class="code" href="classArConfigArg.html" title="Argument class for ArConfig.">ArConfigArg</a>(<span class="stringliteral">"ExampleIntegerParameter"</span>, &amp;myIntParam, <span class="stringliteral">"Example parameter integer."</span>, -10, 10), <span class="stringliteral">"Example Section"</span>, <a name="a6"></a><a class="code" href="classArPriority.html#ee18574a3aae3c790bd3dadc13cff9a311a1e48113dade987dbbc50383e13210" title="Intermediate things that users may want to modify.">ArPriority::NORMAL</a>);
    
    <span class="comment">// Add a floating point number which ranges from 0.0 to 1.0:</span>
    config-&gt;<a class="code" href="classArConfig.html#c8c17f43d6e597f660cad0c180c8ab0b" title="Command to add a parameter to the given section with given priority.">addParam</a>( <a class="code" href="classArConfigArg.html" title="Argument class for ArConfig.">ArConfigArg</a>(<span class="stringliteral">"ExampleDoubleParameter"</span>, &amp;myDoubleParam, <span class="stringliteral">"Example double precision floating point number."</span>, 0.0, 1.0), <span class="stringliteral">"Example Section"</span>, <a class="code" href="classArPriority.html#ee18574a3aae3c790bd3dadc13cff9a311a1e48113dade987dbbc50383e13210" title="Intermediate things that users may want to modify.">ArPriority::NORMAL</a>);

    <span class="comment">// Essential parameters can be placed in the "Important" priority level:</span>
    config-&gt;<a class="code" href="classArConfig.html#c8c17f43d6e597f660cad0c180c8ab0b" title="Command to add a parameter to the given section with given priority.">addParam</a>( <a class="code" href="classArConfigArg.html" title="Argument class for ArConfig.">ArConfigArg</a>(<span class="stringliteral">"ExampleBoolParameter"</span>, &amp;myBoolParam, <span class="stringliteral">"Example boolean parameter."</span>), <span class="stringliteral">"Example Section"</span>, <a name="a7"></a><a class="code" href="classArPriority.html#ee18574a3aae3c790bd3dadc13cff9a3f836d71b4aed41066c4e944d58177210" title="Basic things that should be modified to suit.">ArPriority::IMPORTANT</a>);

    <span class="comment">// Unimportant parameters can be placed in the "Trivial" priority level:</span>
    myStringParam[0] = <span class="charliteral">'\0'</span>;  <span class="comment">// make string empty</span>
    config-&gt;<a class="code" href="classArConfig.html#c8c17f43d6e597f660cad0c180c8ab0b" title="Command to add a parameter to the given section with given priority.">addParam</a>( <a class="code" href="classArConfigArg.html" title="Argument class for ArConfig.">ArConfigArg</a>(<span class="stringliteral">"ExampleStringParameter"</span>, myStringParam, <span class="stringliteral">"Example string parameter."</span>, 256), <span class="stringliteral">"Example Section"</span>, <a name="a8"></a><a class="code" href="classArPriority.html#ee18574a3aae3c790bd3dadc13cff9a340f7bd43e779685d15dbfbfc712fd94e" title="Advanced items (alias for historic reasons).">ArPriority::TRIVIAL</a>);

    <span class="comment">// You can set a callback to be invoked when the configuration changes, in</span>
    <span class="comment">// case you need to respond to any changes in the parameter values:</span>
    config-&gt;<a name="a9"></a><a class="code" href="classArConfig.html#b6632033992fd48cb2369350a749f0b8">addProcessFileCB</a>(&amp;myProcessConfigCB, 0);
  }

  
  <span class="comment">// Method called by config process callback when a new file is loaded.</span>
  <span class="comment">// It can return false to indicate an error, or true to indicate no error.</span>
  <span class="keywordtype">bool</span> processConfigFile() 
  {
    <a name="a10"></a><a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a name="a11"></a><a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"configExample: Config changed. New values: int=%d, float=%f, bool=%s, string=\"%s\"."</span>, myIntParam, myDoubleParam, myBoolParam?<span class="stringliteral">"true"</span>:<span class="stringliteral">"false"</span>, myStringParam);
    <span class="keywordflow">return</span> <span class="keyword">true</span>;
  }
};
  
<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)
{
  <a name="a12"></a><a class="code" href="classAria.html#d99c16b5d947229d9f8e1c5b2d4cdd73" title="Initialize Aria global data struture and perform OS-specific initialization, including...">Aria::init</a>();
  <a name="_a13"></a><a class="code" href="classArArgumentParser.html" title="Class for parsing arguments.">ArArgumentParser</a> argParser(&amp;argc, argv);
  argParser.loadDefaultArguments();
  <span class="keywordflow">if</span> (argc &lt; 2 || !<a name="a14"></a><a class="code" href="classAria.html#1b090c01d88bb420b8cf8e0384d25ee1" title="Parses the arguments for the program (calls all the callbacks added with addParseArgsCB())...">Aria::parseArgs</a>() || argParser.checkArgument(<span class="stringliteral">"-help"</span>))
  {
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a name="a15"></a><a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>, <span class="stringliteral">"configExample usage: configExample &lt;config file&gt;.\nFor example, \"configExample examples/configExample.cfg\"."</span>);
    <a name="a16"></a><a class="code" href="classAria.html#10d71f3d4d0cf7f38c58a1f749f64a42" title="Logs all the options for the program (Calls all the callbacks added with addLogOptionsCB())...">Aria::logOptions</a>();
    <a name="a17"></a><a class="code" href="classAria.html#6abc3d39b3e9548063bb8e78375acc17" title="Shutdown all Aria processes/threads, call exit callbacks, and exit the program.">Aria::exit</a>(1);
    <span class="keywordflow">return</span> 1;
  }
  
  <span class="comment">// Object containing config parameters, and responding to changes:</span>
  ConfigExample configExample;

  <span class="comment">// Load a config file given on the command line into the global </span>
  <span class="comment">// ArConfig object kept by Aria.  Normally ArConfig expects config</span>
  <span class="comment">// files to be in the main ARIA directory (i.e. /usr/local/Aria or</span>
  <span class="comment">// a directory specified by the $ARIA environment variable).</span>
  <span class="keywordtype">char</span> error[512];
  <span class="keyword">const</span> <span class="keywordtype">char</span>* filename = argParser.getArg(1);
  <a class="code" href="classArConfig.html" title="Stores configuration information which may be read to and from files or other sources...">ArConfig</a>* config = <a class="code" href="classAria.html#ce50b4190f04bcacaf285bb5830c5fc2" title="Gets the ArConfig for this program.">Aria::getConfig</a>();
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"configExample: loading configuration file \"%s\"..."</span>, filename);
  <span class="keywordflow">if</span> (! config-&gt;<a name="a18"></a><a class="code" href="classArConfig.html#baba923a5a72dc7c1f1d69efe8f5f4fa" title="Parse a config file.">parseFile</a>(filename, <span class="keyword">true</span>, <span class="keyword">false</span>, error, 512) )
  {
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>, <span class="stringliteral">"configExample: Error loading configuration file \"%s\" %s. Try \"examples/configExample.cfg\"."</span>, filename, error);
    <a class="code" href="classAria.html#6abc3d39b3e9548063bb8e78375acc17" title="Shutdown all Aria processes/threads, call exit callbacks, and exit the program.">Aria::exit</a>(-1);
    <span class="keywordflow">return</span> -1;
  }

  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"configExample: Loaded configuration file \"%s\"."</span>, filename);
  
  <span class="comment">// After changing a config value, you should invoke the callbacks:</span>
  <a name="_a19"></a><a class="code" href="classArConfigSection.html">ArConfigSection</a>* section = config-&gt;<a name="a20"></a><a class="code" href="classArConfig.html#4348c2978086ece1e47d90131f597aca">findSection</a>(<span class="stringliteral">"Example Section"</span>);
  <span class="keywordflow">if</span> (section)
  {
    <a class="code" href="classArConfigArg.html" title="Argument class for ArConfig.">ArConfigArg</a>* arg = section-&gt;<a name="a21"></a><a class="code" href="classArConfigSection.html#f54148b95c20a11351602a1fb1e3f8dd" title="Finds a parameter item in this section with the given name. Returns NULL if not found...">findParam</a>(<span class="stringliteral">"ExampleBoolParameter"</span>);
    <span class="keywordflow">if</span> (arg)
    {
      arg-&gt;<a name="a22"></a><a class="code" href="classArConfigArg.html#59cb64c658cce9197878993342be6333" title="Sets the argument value, for bool arguments.">setBool</a>(!arg-&gt;<a name="a23"></a><a class="code" href="classArConfigArg.html#8d2815f97fc48901b441a21a6036ad4a" title="Gets the argument value, for bool arguments.">getBool</a>());
      <span class="keywordflow">if</span> (! config-&gt;<a name="a24"></a><a class="code" href="classArConfig.html#37c26aa78c1ae5ff479d99fd049dc975" title="Call the processFileCBs.">callProcessFileCallBacks</a>(<span class="keyword">false</span>, error, 512) )
      {
        <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>, <span class="stringliteral">"configExample: Error processing modified config: %s."</span>, error);
      }
      <span class="keywordflow">else</span>
      {
        <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"configExample: Successfully modified config and invoked callbacks."</span>);
      }
    }
  }

  <span class="comment">// You can save the configuration as well:</span>
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"configExample: Saving configuration..."</span>);
  <span class="keywordflow">if</span>(!config-&gt;<a name="a25"></a><a class="code" href="classArConfig.html#d4497befaa4175348b8a9329c57c5b63" title="Write out a config file.">writeFile</a>(filename))
  {
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>, <span class="stringliteral">"configExample: Error saving configuration to file \"%s\"!"</span>, filename);
  }

  <span class="comment">// end of program.</span>
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"configExample: end of program."</span>);
  <a class="code" href="classAria.html#6abc3d39b3e9548063bb8e78375acc17" title="Shutdown all Aria processes/threads, call exit callbacks, and exit the program.">Aria::exit</a>(0);
  <span class="keywordflow">return</span> 0;
}
</pre></div> </div>
<hr size="1"><address style="text-align: right;"><small>Generated on Wed Aug 1 12:22:50 2012 for Aria by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
