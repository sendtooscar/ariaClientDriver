<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Aria: seekurPower.cpp</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="classes.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>seekurPower.cpp</h1>Control Seekur or Seekur Jr. accessory power switching from command line options. Run with -help for help on command line options. See robot manuals and notes on <a href="http://robots.mobilerobots.com">http://robots.mobilerobots.com</a> for more information.<p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include "Aria.h"</span>

<span class="keyword">typedef</span> <span class="keyword">struct </span>{
  <span class="keyword">const</span> <span class="keywordtype">char</span> *option;
  <span class="keywordtype">int</span> port;
  <span class="keyword">const</span> <span class="keywordtype">char</span> *description;
  <span class="keywordtype">int</span> <span class="keyword">set</span>;
} powerspec;

powerspec PowerSpecs[] = {
  {<span class="stringliteral">"pc2"</span>, 1,  <span class="stringliteral">"Turn onboard computer #2 on or off."</span>, 0},
  {<span class="stringliteral">"pc3"</span>, 13,  <span class="stringliteral">"Turn onboard computer #3 on or off."</span>, 0},
  {<span class="stringliteral">"pc4"</span>, 14,  <span class="stringliteral">"Turn onboard computer #4 on or off"</span>, 0},
  {<span class="stringliteral">"pc5"</span>, 15,  <span class="stringliteral">"Turn onboard computer #5 on or off."</span>, 0},
  {<span class="stringliteral">"lrf1"</span>, 9,  <span class="stringliteral">"Turn laser rangefinder #1 on or off."</span>, 0},
  {<span class="stringliteral">"lrf2"</span>, 24,  <span class="stringliteral">"Turn laser rangefinder #2 on or off."</span>, 0},
  {<span class="stringliteral">"lrf1heat"</span>, 11,  <span class="stringliteral">"Turn laser rangefinder #1's heater on or off."</span>, 0},
  {<span class="stringliteral">"lrf2heat"</span>, 27,  <span class="stringliteral">"Turn laser rangefinder #2's heater on or off."</span>, 0},
  {<span class="stringliteral">"gps"</span>, 6, <span class="stringliteral">"Turn GPS receeiver on or off."</span>, 0},
  {<span class="stringliteral">"poe"</span>, 4, <span class="stringliteral">"Turn 12V Power over Ethernet port on or off."</span>, 0},
  {<span class="stringliteral">"lan"</span>, 5, <span class="stringliteral">"Turn internal LAN ethernet switch on or off."</span>, 0},
  {<span class="stringliteral">"camera"</span>, 12, <span class="stringliteral">"Turn the 24V RVision camera on or off."</span>, 0},
  {<span class="stringliteral">"rvision"</span>, 12, <span class="stringliteral">"Turn the 24V RVision camera on or off."</span>, 0},
  {<span class="stringliteral">"ptu1"</span>, 9, <span class="stringliteral">"Turn pan/tilt unit #1 on or off."</span>, 0},
  {<span class="stringliteral">"ptu2"</span>, 22, <span class="stringliteral">"Turn pan/tilt unit #2 on or off."</span>, 0},
  {<span class="stringliteral">"ptu3"</span>, 23, <span class="stringliteral">"Turn pan/tilt unit #3 on or off."</span>, 0},
  {<span class="stringliteral">"arm"</span>, 29, <span class="stringliteral">"Turn the 24V manipulator arm on or off."</span>, 0},
  {<span class="stringliteral">"armcam"</span>, 7, <span class="stringliteral">"Turn the arm camera or other 12V arm accessories on or off."</span>, 0}
};

<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)
{
  <span class="keywordtype">int</span> numPowerSpecs = <span class="keyword">sizeof</span>(PowerSpecs)/<span class="keyword">sizeof</span>(powerspec);
  <a name="a0"></a><a class="code" href="classAria.html#d99c16b5d947229d9f8e1c5b2d4cdd73" title="Initialize Aria global data struture and perform OS-specific initialization, including...">Aria::init</a>();
  <a name="_a1"></a><a class="code" href="classArArgumentParser.html" title="Class for parsing arguments.">ArArgumentParser</a> parser(&amp;argc, argv);
  parser.loadDefaultArguments();
  <a name="_a2"></a><a class="code" href="classArRobot.html" title="Central class for communicating with and operating the robot.">ArRobot</a> robot;
  <a name="_a3"></a><a class="code" href="classArRobotConnector.html">ArRobotConnector</a> robotConnector(&amp;parser, &amp;robot);

  <span class="keywordflow">if</span>(!robotConnector.connectRobot())
  {
    <a name="a4"></a><a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a name="a5"></a><a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>, <span class="stringliteral">"seekurPower: Error: Could not connect to the robot."</span>);
    <a name="a6"></a><a class="code" href="classAria.html#10d71f3d4d0cf7f38c58a1f749f64a42" title="Logs all the options for the program (Calls all the callbacks added with addLogOptionsCB())...">Aria::logOptions</a>();
    <a name="a7"></a><a class="code" href="classAria.html#6abc3d39b3e9548063bb8e78375acc17" title="Shutdown all Aria processes/threads, call exit callbacks, and exit the program.">Aria::exit</a>(1);
  }

  <span class="keywordflow">if</span> (!<a name="a8"></a><a class="code" href="classAria.html#1b090c01d88bb420b8cf8e0384d25ee1" title="Parses the arguments for the program (calls all the callbacks added with addParseArgsCB())...">Aria::parseArgs</a>() || parser.checkArgument(<span class="stringliteral">"help"</span>))
  {
    <a class="code" href="classAria.html#10d71f3d4d0cf7f38c58a1f749f64a42" title="Logs all the options for the program (Calls all the callbacks added with addLogOptionsCB())...">Aria::logOptions</a>();
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>, <span class="stringliteral">"Options for seekurPower command (your robot may not have some of these devices):"</span>);
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>, <span class="stringliteral">"-&lt;n&gt; &lt;on|off|reset&gt;\t\tTurn port &lt;n&gt; on or off, or reset by turning off then on again. Refer to robot documentation or http://robots.mobilerobots.com/wiki/Seekur_Switched_Power_Outputs for list and notes."</span>);
    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; numPowerSpecs; ++i)
      <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>, <span class="stringliteral">"-%s &lt;on|off|reset&gt;\t\t%s (port %d)"</span>, PowerSpecs[i].option, PowerSpecs[i].description, PowerSpecs[i].port);
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>, <span class="stringliteral">"-robotOff\t\tTurn whole robot off"</span>);
    <a class="code" href="classAria.html#6abc3d39b3e9548063bb8e78375acc17" title="Shutdown all Aria processes/threads, call exit callbacks, and exit the program.">Aria::exit</a>(2);
  }

  <span class="keywordflow">if</span>(parser.checkArgument(<span class="stringliteral">"-robotOff"</span>))
  {
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>, <span class="stringliteral">"-robotOff given -- powering down entire robot with command #119 in 5 seconds..."</span>);
    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 5; i &gt; 0; --i)
    {
      <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>, <span class="stringliteral">"Shutting down in %d seconds..."</span>, i);
      <a name="a9"></a><a class="code" href="classArUtil.html#4dfb878a3f9123b8dd96ae05b2fd94cb" title="Sleep for the given number of milliseconds.">ArUtil::sleep</a>(1000);
    }
    robot.<a name="a10"></a><a class="code" href="classArRobot.html#165e27bc81ed9f159820dfdf215d5500" title="Sends a command to the robot with no arguments.">com</a>(119);
    <a class="code" href="classAria.html#6abc3d39b3e9548063bb8e78375acc17" title="Shutdown all Aria processes/threads, call exit callbacks, and exit the program.">Aria::exit</a>(0);
  }
      

  std::list&lt;powerspec&gt; todo;

  <span class="keywordtype">int</span> nargs = parser.getArgc();
  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> argi = 1; argi &lt; nargs; ++argi)
  {
    <span class="keyword">const</span> <span class="keywordtype">char</span> *opt = parser.getArg(argi);
    <span class="keywordflow">if</span>(opt[0] != <span class="charliteral">'-'</span>)
    {
      <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>, <span class="stringliteral">"seekurPower: Error: invalid option %s. Use -help for list of options."</span>, opt);
      <a class="code" href="classAria.html#6abc3d39b3e9548063bb8e78375acc17" title="Shutdown all Aria processes/threads, call exit callbacks, and exit the program.">Aria::exit</a>(4);
    }
    ++opt;
    <span class="keywordflow">if</span>(opt[0] == <span class="charliteral">'-'</span>)
      ++opt;
    <span class="keywordtype">bool</span> found = <span class="keyword">false</span>;
    <span class="keywordflow">if</span>(argi == nargs-1) <span class="comment">// option given as last argument, with no value</span>
    {
      <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>, <span class="stringliteral">"seekurPower: Error: Missing argument to last option %s. Specify on, off or reset."</span>, opt);
      <a class="code" href="classAria.html#6abc3d39b3e9548063bb8e78375acc17" title="Shutdown all Aria processes/threads, call exit callbacks, and exit the program.">Aria::exit</a>(7);
    }
    <span class="keyword">const</span> <span class="keywordtype">char</span> *val = parser.getArg(++argi);
    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> pi = 0; pi &lt; numPowerSpecs; ++pi)
    {
      powerspec ps = PowerSpecs[pi];
      <span class="keywordflow">if</span>(strcmp(opt, ps.option) == 0) 
      {
        found = <span class="keyword">true</span>;
        <span class="keywordflow">if</span>(strcmp(val, <span class="stringliteral">"on"</span>) == 0)
          ps.set = 1;
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(strcmp(val, <span class="stringliteral">"off"</span>) == 0)
          ps.set = 0;
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(strcmp(val, <span class="stringliteral">"reset"</span>) == 0)
          ps.set = 2;
        <span class="keywordflow">else</span>
        {
          <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>, <span class="stringliteral">"seekurPower: Error: Invalid value '%s' for option %s. Use on, off or reset."</span>, val, opt);
          <a class="code" href="classAria.html#6abc3d39b3e9548063bb8e78375acc17" title="Shutdown all Aria processes/threads, call exit callbacks, and exit the program.">Aria::exit</a>(6);
        }
        todo.push_back(ps);
        <span class="keywordflow">break</span>;
      }
    }
    <span class="keywordflow">if</span>(!found)
    {
      <span class="keywordflow">if</span>(<a name="a11"></a><a class="code" href="classArUtil.html#f78edf7d12d4e609d639ee774dc96929" title="Returns true if this string is only numeric (i.e. it contains only numeric.">ArUtil::isOnlyNumeric</a>(opt))
      {
        found = <span class="keyword">true</span>;
        powerspec ps;
        ps.option = opt;
        ps.description = NULL;
        ps.port = atoi(opt);
        <span class="keywordflow">if</span>(strcmp(val, <span class="stringliteral">"on"</span>) == 0)
          ps.set = 1;
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(strcmp(val, <span class="stringliteral">"off"</span>) == 0)
          ps.set = 0;
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(strcmp(val, <span class="stringliteral">"reset"</span>) == 0)
          ps.set = 2;
        todo.push_back(ps);
      }
    }
    <span class="keywordflow">if</span>(!found)
    {
      <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>, <span class="stringliteral">"seekurPower: Warning: unrecognized option %s. Use -help for list of options."</span>, opt);
    }
  }


  <span class="keywordflow">for</span>(std::list&lt;powerspec&gt;::const_iterator i = todo.begin(); i != todo.end(); ++i)
  {
    powerspec ps = *i;
    <span class="keywordflow">if</span>(ps.set == 2)
    {
      <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a name="a12"></a><a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"seekurPower: Switching %s (port %d) off, waiting 2 seconds., then switching it back on again..."</span>, ps.option, ps.port);
      robot.<a name="a13"></a><a class="code" href="classArRobot.html#37991669749d064691406e575b00564d" title="Sends a command to the robot with two bytes for argument.">com2Bytes</a>(116, ps.port, 0);
      <a class="code" href="classArUtil.html#4dfb878a3f9123b8dd96ae05b2fd94cb" title="Sleep for the given number of milliseconds.">ArUtil::sleep</a>(2000);
      robot.<a class="code" href="classArRobot.html#37991669749d064691406e575b00564d" title="Sends a command to the robot with two bytes for argument.">com2Bytes</a>(116, ps.port, 1);
    }
    <span class="keywordflow">else</span>
    {
      <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"seekurPower: Switching %s (port %d) %s..."</span>, ps.option, ps.port, ps.set?<span class="stringliteral">"on"</span>:<span class="stringliteral">"off"</span>);
      robot.<a class="code" href="classArRobot.html#37991669749d064691406e575b00564d" title="Sends a command to the robot with two bytes for argument.">com2Bytes</a>(116, ps.port, ps.set);
    }
  }
  

  <a class="code" href="classAria.html#6abc3d39b3e9548063bb8e78375acc17" title="Shutdown all Aria processes/threads, call exit callbacks, and exit the program.">Aria::exit</a>(0);
}

</pre></div> </div>
<hr size="1"><address style="text-align: right;"><small>Generated on Wed Aug 1 12:22:50 2012 for Aria by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
