<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Aria: simpleConnect.cpp</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="classes.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>simpleConnect.cpp</h1>example showing how to connect to the robot with <a class="el" href="classArRobotConnector.html">ArRobotConnector</a><p>
One of the simplest ARIA programs possible: Connects with <a class="el" href="classArRobotConnector.html">ArRobotConnector</a>, waits 3 seconds doing nothing, then exits.<p>
This program will work either with the MobileSim simulator or on a real robot's onboard computer. (Or use -remoteHost to connect to a wireless ethernet-serial bridge.)<p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include "Aria.h"</span>

<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)
{
  <a name="a0"></a><a class="code" href="classAria.html#d99c16b5d947229d9f8e1c5b2d4cdd73" title="Initialize Aria global data struture and perform OS-specific initialization, including...">Aria::init</a>();
  <a name="_a1"></a><a class="code" href="classArArgumentParser.html" title="Class for parsing arguments.">ArArgumentParser</a> parser(&amp;argc, argv);
  parser.<a name="a2"></a><a class="code" href="classArArgumentParser.html#501694b62a7f8b0c3cadd84aeafe1b35" title="Adds args from default files and environmental variables.">loadDefaultArguments</a>();
  <a name="_a3"></a><a class="code" href="classArRobot.html" title="Central class for communicating with and operating the robot.">ArRobot</a> robot;

  <span class="comment">// Connect to the robot, get some initial data from it such as type and name,</span>
  <span class="comment">// and then load parameter files for this robot.</span>
  <a name="_a4"></a><a class="code" href="classArRobotConnector.html">ArRobotConnector</a> robotConnector(&amp;parser, &amp;robot);
  <span class="keywordflow">if</span>(!robotConnector.<a name="a5"></a><a class="code" href="classArRobotConnector.html#b192ac393d9cc1e5b61b1a82b08d085d" title="Sets up the robot then connects it.">connectRobot</a>())
  {
    <a name="a6"></a><a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a name="a7"></a><a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>, <span class="stringliteral">"simpleConnect: Could not connect to the robot."</span>);
    <span class="keywordflow">if</span>(parser.<a name="a8"></a><a class="code" href="classArArgumentParser.html#c3889cbdfa862031c51bf80e06954914" title="Checks for the help strings and warns about unparsed arguments.">checkHelpAndWarnUnparsed</a>())
    {
        <span class="comment">// -help not given</span>
        <a name="a9"></a><a class="code" href="classAria.html#10d71f3d4d0cf7f38c58a1f749f64a42" title="Logs all the options for the program (Calls all the callbacks added with addLogOptionsCB())...">Aria::logOptions</a>();
        <a name="a10"></a><a class="code" href="classAria.html#6abc3d39b3e9548063bb8e78375acc17" title="Shutdown all Aria processes/threads, call exit callbacks, and exit the program.">Aria::exit</a>(1);
    }
  }

  <span class="keywordflow">if</span> (!<a name="a11"></a><a class="code" href="classAria.html#1b090c01d88bb420b8cf8e0384d25ee1" title="Parses the arguments for the program (calls all the callbacks added with addParseArgsCB())...">Aria::parseArgs</a>() || !parser.<a class="code" href="classArArgumentParser.html#c3889cbdfa862031c51bf80e06954914" title="Checks for the help strings and warns about unparsed arguments.">checkHelpAndWarnUnparsed</a>())
  {
    <a class="code" href="classAria.html#10d71f3d4d0cf7f38c58a1f749f64a42" title="Logs all the options for the program (Calls all the callbacks added with addLogOptionsCB())...">Aria::logOptions</a>();
    <a class="code" href="classAria.html#6abc3d39b3e9548063bb8e78375acc17" title="Shutdown all Aria processes/threads, call exit callbacks, and exit the program.">Aria::exit</a>(1);
  }

  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a name="a12"></a><a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"simpleConnect: Connected."</span>);

  <span class="comment">// Start the robot processing cycle running in the background.</span>
  <span class="comment">// True parameter means that if the connection is lost, then the </span>
  <span class="comment">// run loop ends.</span>
  robot.<a name="a13"></a><a class="code" href="classArRobot.html#79199f70fee00e4e4a66452d1bbea19b" title="Starts the instance to do processing in its own new thread.">runAsync</a>(<span class="keyword">true</span>);

  <span class="comment">// Print out some data from the SIP.  We must "lock" the ArRobot object</span>
  <span class="comment">// before calling its methods, and "unlock" when done, to prevent conflicts</span>
  <span class="comment">// with the background thread started by the call to robot.runAsync() above.</span>
  <span class="comment">// See the section on threading in the manual for more about this.</span>
  robot.<a name="a14"></a><a class="code" href="classArRobot.html#5aecc7ac998c9a31b82fdb904efa8609" title="Lock the robot instance.">lock</a>();
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"simpleConnect: Pose=(%.2f,%.2f,%.2f), Trans. Vel=%.2f, Battery=%.2fV"</span>,
    robot.<a name="a15"></a><a class="code" href="classArRobot.html#4c994926aaefc4c86380f1a74e508a76" title="Gets the global X position of the robot.">getX</a>(), robot.<a name="a16"></a><a class="code" href="classArRobot.html#9164db66102fdf9d422feefdadffca92" title="Gets the global Y position of the robot.">getY</a>(), robot.<a name="a17"></a><a class="code" href="classArRobot.html#efe932449c50da9ca0f8084cd9639583" title="Gets the global angular position (&amp;quot;theta&amp;quot;) of the robot.">getTh</a>(), robot.<a name="a18"></a><a class="code" href="classArRobot.html#d75dbd9aede7b7f57c9a38902b8aa1ce" title="Gets the current translational velocity of the robot.">getVel</a>(), robot.<a name="a19"></a><a class="code" href="classArRobot.html#8d1637a9f3d37e55768d2aa1c8c272d6" title="Gets the battery voltage of the robot (normalized to 12 volt system).">getBatteryVoltage</a>());
  robot.<a name="a20"></a><a class="code" href="classArRobot.html#403d9de010dc2b8d478cd0b14b2d9491" title="Unlock the robot instance.">unlock</a>();

  <span class="comment">// Sleep for 3 seconds.</span>
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"simpleConnect: Sleeping for 3 seconds..."</span>);
  <a name="a21"></a><a class="code" href="classArUtil.html#4dfb878a3f9123b8dd96ae05b2fd94cb" title="Sleep for the given number of milliseconds.">ArUtil::sleep</a>(3000);

  
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"simpleConnect: Ending robot thread..."</span>);
  robot.<a name="a22"></a><a class="code" href="classArRobot.html#ff02cf7043c2e7239ec6b6e11ff6b146" title="Stops the robot from doing any more processing.">stopRunning</a>();

  <span class="comment">// wait for the thread to stop</span>
  robot.<a name="a23"></a><a class="code" href="classArRobot.html#95201be7c39b521983b51e6f5d9303e4" title="Suspend calling thread until the ArRobot run loop has exited.">waitForRunExit</a>();

  <span class="comment">// exit</span>
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"simpleConnect: Exiting."</span>);
  <a class="code" href="classAria.html#6abc3d39b3e9548063bb8e78375acc17" title="Shutdown all Aria processes/threads, call exit callbacks, and exit the program.">Aria::exit</a>(0);
}
</pre></div> </div>
<hr size="1"><address style="text-align: right;"><small>Generated on Wed Aug 1 12:22:50 2012 for Aria by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
