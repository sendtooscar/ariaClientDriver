<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Aria: rvisionCameraExample.cpp</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="classes.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>rvisionCameraExample.cpp</h1>This is an example using the RVision pan/tilt/zoom camera used on Seekur and Seekur Jr.<p>
This program uses key commands to control the pan, tilt, and zoom of the camera.<p>
It defaults to use COM3.<p>
Commands: _________________<p>
UP,DOWN -- tilt up/down by 1 degree LEFT,RIGHT -- pan left/right by 1 degree X,C -- zoom in/out by 10 units (80 total) I -- initialize PTU to default settings &gt;,&lt; -- increase/decrease the positional increment by one 1 degree +,- -- increase/decrease the slew by 5 degrees/sec Z -- move pan and tilt axes to zero H -- Halt all motion S -- Status of camera position and variable values P -- Power on/off the camera ESC -- Exit program<p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include "Aria.h"</span>
<span class="preprocessor">#include "ArRVisionPTZ.h"</span>

<span class="comment">/*</span>
<span class="comment">  This class is the core of this demo, it adds itself to the robot given</span>
<span class="comment">  as a user task, then drives the PTZ camera from the keyboard</span>
<span class="comment">*/</span>
<span class="keyword">class </span>KeyPTU
{
<span class="keyword">public</span>:
  <span class="comment">// constructor</span>
  KeyPTU(<a name="_a0"></a><a class="code" href="classArRobot.html" title="Central class for communicating with and operating the robot.">ArRobot</a> *robot);
  <span class="comment">// destructor, its just empty</span>
  ~KeyPTU(<span class="keywordtype">void</span>) {}
  
  <span class="keywordtype">void</span> up(<span class="keywordtype">void</span>);
  <span class="keywordtype">void</span> down(<span class="keywordtype">void</span>);
  <span class="keywordtype">void</span> left(<span class="keywordtype">void</span>);
  <span class="keywordtype">void</span> right(<span class="keywordtype">void</span>);

  <span class="keywordtype">void</span> greater(<span class="keywordtype">void</span>);
  <span class="keywordtype">void</span> less(<span class="keywordtype">void</span>);
  <span class="keywordtype">void</span> question(<span class="keywordtype">void</span>);
  <span class="keywordtype">void</span> status(<span class="keywordtype">void</span>);

  <span class="keywordtype">void</span> c(<span class="keywordtype">void</span>);
  <span class="keywordtype">void</span> h(<span class="keywordtype">void</span>);
  <span class="keywordtype">void</span> i(<span class="keywordtype">void</span>);
  <span class="keywordtype">void</span> p(<span class="keywordtype">void</span>);
  <span class="keywordtype">void</span> x(<span class="keywordtype">void</span>);
  <span class="keywordtype">void</span> z(<span class="keywordtype">void</span>);

  <span class="keywordtype">void</span> r(<span class="keywordtype">void</span>);
  <span class="comment">// the callback function</span>
  <span class="keywordtype">void</span> drive(<span class="keywordtype">void</span>);

  <span class="keywordtype">void</span> power(<span class="keywordtype">bool</span> p);
<span class="keyword">protected</span>:

  <a name="_a1"></a><a class="code" href="classArTime.html" title="A class for time readings and measuring durations.">ArTime</a> myExerciseTime;

  <span class="keywordtype">int</span> myPosIncrement;
  <span class="keywordtype">int</span> myZoomIncrement;

  <span class="keywordtype">bool</span> myMonitor;
  <span class="keywordtype">bool</span> myInit;
  <span class="keywordtype">bool</span> myAbsolute;
  <span class="keywordtype">bool</span> myExercise;

  <span class="keywordtype">void</span> exercise(<span class="keywordtype">void</span>) { myExercise = !myExercise; }

  <a name="_a2"></a><a class="code" href="classArFunctorC.html" title="Functor for a member function.">ArFunctorC&lt;KeyPTU&gt;</a> myUpCB;
  <a class="code" href="classArFunctorC.html" title="Functor for a member function.">ArFunctorC&lt;KeyPTU&gt;</a> myDownCB;
  <a class="code" href="classArFunctorC.html" title="Functor for a member function.">ArFunctorC&lt;KeyPTU&gt;</a> myLeftCB;
  <a class="code" href="classArFunctorC.html" title="Functor for a member function.">ArFunctorC&lt;KeyPTU&gt;</a> myRightCB;

  <a class="code" href="classArFunctorC.html" title="Functor for a member function.">ArFunctorC&lt;KeyPTU&gt;</a> myGreaterCB;
  <a class="code" href="classArFunctorC.html" title="Functor for a member function.">ArFunctorC&lt;KeyPTU&gt;</a> myLessCB;
  <a class="code" href="classArFunctorC.html" title="Functor for a member function.">ArFunctorC&lt;KeyPTU&gt;</a> myQuestionCB;
  <a class="code" href="classArFunctorC.html" title="Functor for a member function.">ArFunctorC&lt;KeyPTU&gt;</a> mySCB;

  <a class="code" href="classArFunctorC.html" title="Functor for a member function.">ArFunctorC&lt;KeyPTU&gt;</a> myECB;
  <a class="code" href="classArFunctorC.html" title="Functor for a member function.">ArFunctorC&lt;KeyPTU&gt;</a> myACB;

  <a class="code" href="classArFunctorC.html" title="Functor for a member function.">ArFunctorC&lt;KeyPTU&gt;</a> myCCB;
<span class="comment">//  ArFunctorC&lt;KeyPTU&gt; myHCB;</span>
  <a class="code" href="classArFunctorC.html" title="Functor for a member function.">ArFunctorC&lt;KeyPTU&gt;</a> myICB;
  <a class="code" href="classArFunctorC.html" title="Functor for a member function.">ArFunctorC&lt;KeyPTU&gt;</a> myPCB;
  <a class="code" href="classArFunctorC.html" title="Functor for a member function.">ArFunctorC&lt;KeyPTU&gt;</a> myXCB;
  <a class="code" href="classArFunctorC.html" title="Functor for a member function.">ArFunctorC&lt;KeyPTU&gt;</a> myZCB;

  <a class="code" href="classArFunctorC.html" title="Functor for a member function.">ArFunctorC&lt;KeyPTU&gt;</a> myRCB;

  <a name="_a3"></a><a class="code" href="classArRVisionPTZ.html">ArRVisionPTZ</a> myPTU;

  <a name="_a4"></a><a class="code" href="classArSerialConnection.html" title="For connecting to devices through a serial port.">ArSerialConnection</a> myCon;

  <span class="keywordtype">bool</span> myPTUInitRequested; 
  <a class="code" href="classArRobot.html" title="Central class for communicating with and operating the robot.">ArRobot</a> *myRobot;

  <a class="code" href="classArFunctorC.html" title="Functor for a member function.">ArFunctorC&lt;KeyPTU&gt;</a> myDriveCB;

  <span class="keywordtype">bool</span> myPowerOn; 
};

<span class="comment">/*</span>
<span class="comment">  Constructor, sets the robot pointer, and some initial values, also note the</span>
<span class="comment">  use of constructor chaining on myPTU and myDriveCB.</span>
<span class="comment">*/</span>
KeyPTU::KeyPTU(<a class="code" href="classArRobot.html" title="Central class for communicating with and operating the robot.">ArRobot</a> *robot) :
  myUpCB(this, &amp;KeyPTU::up),
  myDownCB(this, &amp;KeyPTU::down),
  myLeftCB(this, &amp;KeyPTU::left),
  myRightCB(this, &amp;KeyPTU::right),
  myGreaterCB(this, &amp;KeyPTU::greater),
  myLessCB(this, &amp;KeyPTU::less),
  myQuestionCB(this, &amp;KeyPTU::question),
  mySCB(this, &amp;KeyPTU::status),
  myECB(this, &amp;KeyPTU::exercise),
  myCCB(this, &amp;KeyPTU::c),
<span class="comment">//  myHCB(this, &amp;KeyPTU::h),</span>
  myICB(this, &amp;KeyPTU::i),
  myPCB(this, &amp;KeyPTU::p),
  myXCB(this, &amp;KeyPTU::x),
  myZCB(this, &amp;KeyPTU::z),
  myRCB(this, &amp;KeyPTU::r),

  myPTU(robot),
  myDriveCB(this, &amp;KeyPTU::drive)
{
  <span class="comment">// set the robot pointer and add a robot user task callback (called every</span>
  <span class="comment">// loop)</span>
  <a name="_a5"></a><a class="code" href="classArKeyHandler.html" title="Perform actions when keyboard keys are pressed.">ArKeyHandler</a> *keyHandler;
  myRobot = robot;
  myRobot-&gt;<a name="a6"></a><a class="code" href="classArRobot.html#b3ed1a09a96c009802ed64bbc6c75325" title="Adds a task under the sensor interp part of the syncronous tasks.">addSensorInterpTask</a>(<span class="stringliteral">"KeyPTU"</span>, 50, &amp;myDriveCB);

  myExerciseTime.setToNow();
  myExercise = <span class="keyword">false</span>;


  <span class="keywordflow">if</span> ((keyHandler = <a name="a7"></a><a class="code" href="classAria.html#5b8042b38b19d6a5d3cfbed4df483e67" title="Gets a pointer to the global key handler, if one has been set with setKeyHandler()...">Aria::getKeyHandler</a>()) == NULL)
  {
    keyHandler = <span class="keyword">new</span> <a class="code" href="classArKeyHandler.html" title="Perform actions when keyboard keys are pressed.">ArKeyHandler</a>;
    <a name="a8"></a><a class="code" href="classAria.html#9e5496a4ec2c379c8e18706922b57cc1" title="Sets the key handler, so that other classes can find it using getKeyHandler().">Aria::setKeyHandler</a>(keyHandler);
    myRobot-&gt;attachKeyHandler(keyHandler);
  }

  <span class="keywordflow">if</span> (!keyHandler-&gt;<a name="a9"></a><a class="code" href="classArKeyHandler.html#d5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<a name="a10"></a><a class="code" href="classArKeyHandler.html#665246cd772590dd02ea299dd047899c8a1d3905f01b5d27603bb0528912d341" title="Up arrow (keypad or 4 key dirs).">ArKeyHandler::UP</a>, &amp;myUpCB))
    <a name="a11"></a><a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a name="a12"></a><a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>, <span class="stringliteral">"The key handler already has a key for up, keydrive will not work correctly."</span>);

  <span class="keywordflow">if</span> (!keyHandler-&gt;<a class="code" href="classArKeyHandler.html#d5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<a name="a13"></a><a class="code" href="classArKeyHandler.html#665246cd772590dd02ea299dd047899cb3ecf95789d8f87444856e278393b4d9" title="Down arrow (keypad or 4 key dirs).">ArKeyHandler::DOWN</a>, &amp;myDownCB))
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>, <span class="stringliteral">"The key handler already has a key for down, keydrive will not work correctly."</span>);

  <span class="keywordflow">if</span> (!keyHandler-&gt;<a class="code" href="classArKeyHandler.html#d5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<a name="a14"></a><a class="code" href="classArKeyHandler.html#665246cd772590dd02ea299dd047899c4484301bbabab1fb37e72cbcd6e3e45b" title="Left arrow (keypad or 4 key dirs).">ArKeyHandler::LEFT</a>, &amp;myLeftCB))
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>,  
<span class="stringliteral">"The key handler already has a key for left, keydrive will not work correctly."</span>);

  <span class="keywordflow">if</span> (!keyHandler-&gt;<a class="code" href="classArKeyHandler.html#d5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<a name="a15"></a><a class="code" href="classArKeyHandler.html#665246cd772590dd02ea299dd047899c220c952e7e336650ee7b3e0905971ede" title="Right arrow (keypad or 4 key dirs).">ArKeyHandler::RIGHT</a>, &amp;myRightCB))
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>,  
<span class="stringliteral">"The key handler already has a key for right, keydrive will not work correctly."</span>);

  <span class="keywordflow">if</span> (!keyHandler-&gt;<a class="code" href="classArKeyHandler.html#d5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<span class="charliteral">'&gt;'</span>, &amp;myGreaterCB))
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>,
<span class="stringliteral">"The key handler already has a key for '&gt;', keydrive will not work correctly."</span>);

  <span class="keywordflow">if</span> (!keyHandler-&gt;<a class="code" href="classArKeyHandler.html#d5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<span class="charliteral">'&lt;'</span>, &amp;myLessCB))
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>,
<span class="stringliteral">"The key handler already has a key for '&lt;', keydrive will not work correctly."</span>);

  <span class="keywordflow">if</span> (!keyHandler-&gt;<a class="code" href="classArKeyHandler.html#d5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<span class="charliteral">'?'</span>, &amp;myQuestionCB))
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>,
<span class="stringliteral">"The key handler already has a key for '?', keydrive will not work correctly."</span>);

  <span class="keywordflow">if</span> (!keyHandler-&gt;<a class="code" href="classArKeyHandler.html#d5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<span class="charliteral">'c'</span>, &amp;myCCB))
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>,
<span class="stringliteral">"The key handler already has a key for 'C', keydrive will not work correctly."</span>);

<span class="comment">/*</span>
<span class="comment">  if (!keyHandler-&gt;addKeyHandler('h', &amp;myHCB))</span>
<span class="comment">    ArLog::log(ArLog::Terse,</span>
<span class="comment">"The key handler already has a key for 'H', keydrive will not work correctly.");</span>
<span class="comment">*/</span>

  <span class="keywordflow">if</span> (!keyHandler-&gt;<a class="code" href="classArKeyHandler.html#d5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<span class="charliteral">'i'</span>, &amp;myICB))
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>,
<span class="stringliteral">"The key handler already has a key for 'I', keydrive will not work correctly."</span>);

  <span class="keywordflow">if</span> (!keyHandler-&gt;<a class="code" href="classArKeyHandler.html#d5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<span class="charliteral">'p'</span>, &amp;myPCB))
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>,
<span class="stringliteral">"The key handler already has a key for 'P', keydrive will not work correctly."</span>);

  <span class="keywordflow">if</span> (!keyHandler-&gt;<a class="code" href="classArKeyHandler.html#d5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<span class="charliteral">'r'</span>, &amp;myRCB))
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>,
<span class="stringliteral">"The key handler already has a key for 'R', keydrive will not work correctly."</span>);

  <span class="keywordflow">if</span> (!keyHandler-&gt;<a class="code" href="classArKeyHandler.html#d5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<span class="charliteral">'s'</span>, &amp;mySCB))
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>,
<span class="stringliteral">"The key handler already has a key for 'S', keydrive will not work correctly."</span>);

  <span class="keywordflow">if</span> (!keyHandler-&gt;<a class="code" href="classArKeyHandler.html#d5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<span class="charliteral">'x'</span>, &amp;myXCB))
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>,
<span class="stringliteral">"The key handler already has a key for 'X', keydrive will not work correctly."</span>);

  <span class="keywordflow">if</span> (!keyHandler-&gt;<a class="code" href="classArKeyHandler.html#d5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<span class="charliteral">'z'</span>, &amp;myZCB))
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>,
<span class="stringliteral">"The key handler already has a key for 'Z', keydrive will not work correctly."</span>);

  <span class="keywordflow">if</span> (!keyHandler-&gt;<a class="code" href="classArKeyHandler.html#d5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<span class="charliteral">'a'</span>, &amp;myACB))
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>, <span class="stringliteral">"The key handler already has a key for 'A', keydrive will not work correctly."</span>);

  <span class="keywordflow">if</span> (!keyHandler-&gt;<a class="code" href="classArKeyHandler.html#d5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<span class="charliteral">'e'</span>, &amp;myECB))
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>, <span class="stringliteral">"The key handler already has a key for 'E', keydrive will not work correctly."</span>);




  myPTUInitRequested = <span class="keyword">false</span>;
  myPosIncrement = 1;
  myZoomIncrement = 50;
  myPowerOn = <span class="keyword">false</span>;
}

<span class="keywordtype">void</span> KeyPTU::power(<span class="keywordtype">bool</span> state)
{
  <span class="keywordflow">if</span>(state)
  {
    myRobot-&gt;com2Bytes(116, 12, 1);
    myPowerOn = <span class="keyword">true</span>;
  }
  <span class="keywordflow">else</span>
  {
    myRobot-&gt;com2Bytes(116, 12, 0);
    myPowerOn = <span class="keyword">false</span>;
  }
}

<span class="keywordtype">void</span> KeyPTU::right(<span class="keywordtype">void</span>)
{
  myPTU.panRel(myPosIncrement);
}

<span class="keywordtype">void</span> KeyPTU::left(<span class="keywordtype">void</span>)
{
  myPTU.panRel(-myPosIncrement);
}

<span class="keywordtype">void</span> KeyPTU::up(<span class="keywordtype">void</span>)
{
  myPTU.tiltRel(myPosIncrement);
}

<span class="keywordtype">void</span> KeyPTU::down(<span class="keywordtype">void</span>)
{
  myPTU.tiltRel(-myPosIncrement);
}

<span class="keywordtype">void</span> KeyPTU::x(<span class="keywordtype">void</span>)
{
  myPTU.zoom(myPTU.getZoom() + myZoomIncrement);
}

<span class="keywordtype">void</span> KeyPTU::c(<span class="keywordtype">void</span>)
{
  myPTU.zoom(myPTU.getZoom() - myZoomIncrement);
}

<span class="keywordtype">void</span> KeyPTU::i(<span class="keywordtype">void</span>)
{
  myPTU.init();
}


<span class="keywordtype">void</span> KeyPTU::greater(<span class="keywordtype">void</span>)
{
  myPosIncrement += 1;
  
  <span class="keywordflow">if</span> (myPosIncrement &gt; myPTU.getMaxPosPan())            <span class="comment">//Use pan range as reference for largest allowable positional increment</span>
    myPosIncrement = myPTU.getMaxPosPan();

  status();
}

<span class="keywordtype">void</span> KeyPTU::less(<span class="keywordtype">void</span>)
{
  myPosIncrement -= 1;

  <span class="keywordflow">if</span> (myPosIncrement &lt; 0)
    myPosIncrement = 0;

  status();
}


<span class="keywordtype">void</span> KeyPTU::z(<span class="keywordtype">void</span>)
{
  myPTU.panTilt(0,0);
  myPTU.zoom(0);
  status();
}


<span class="keywordtype">void</span> KeyPTU::r(<span class="keywordtype">void</span>)
{
  myPTU.reset();
}


<span class="keywordtype">void</span> KeyPTU::question(<span class="keywordtype">void</span>)
{
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a name="a16"></a><a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"\r\nCommands:\r\n_________________\r\n"</span>);
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"UP,DOWN     -- tilt up/down by 1 increment"</span>);
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"LEFT,RIGHT  -- pan left/right by 1 increment"</span>);
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"X,C         -- zoom in/out by 50 units (2140 max)"</span>);
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"I           -- initialize PTU to default settings"</span>);
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"&gt;,&lt;         -- increase/decrease the positional increment by 1 degree"</span>);
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"+,-         -- increase/decrease the slew by 5 degrees/sec"</span>);
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"Z           -- move pan and tilt axes to zero"</span>);
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"E           -- toggle exercise mode"</span>);
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"H           -- Halt all motion"</span>);
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"S           -- Status of camera position and variable values"</span>);
<span class="comment">//  ArLog::log(ArLog::Normal, "P           -- Power on/off the camera");</span>
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"R           -- Reset the camera"</span>);
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"ESC         -- Exit program"</span>);
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"\r\n"</span>);
}

<span class="keywordtype">void</span> KeyPTU::status(<span class="keywordtype">void</span>)
{
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"\r\nStatus:\r\n_________________________\r\n"</span>);
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"Pan Position       =  %.0f deg"</span>, myPTU.getPan());
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"Tilt Position      =  %.0f deg"</span>, myPTU.getTilt());
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"Zoom Position      =  %d"</span>, myPTU.getZoom());
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"Position Increment =  %d deg"</span>, myPosIncrement);
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"Exercise           =  %d"</span>, myExercise);
  <span class="keywordflow">if</span> (myPowerOn)
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"Power is ON"</span>);
  <span class="keywordflow">else</span>
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"Power is OFF"</span>);
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"\r\n"</span>);
}

<span class="comment">/* not implemented yet in ArRVision</span>
<span class="comment">void KeyPTU::h(void)</span>
<span class="comment">{</span>
<span class="comment">  myPTU.haltPanTilt();</span>
<span class="comment">  myPTU.haltZoom();</span>
<span class="comment">}</span>
<span class="comment">*/</span>

<span class="keywordtype">void</span> KeyPTU::p(<span class="keywordtype">void</span>)
{
  <span class="comment">// toggle power state and print new status</span>
  power(!myPowerOn);
  status();
}

<span class="comment">// the important function</span>
<span class="keywordtype">void</span> KeyPTU::drive(<span class="keywordtype">void</span>)
{
  <span class="comment">// if the PTU isn't initialized, initialize it here... it has to be </span>
  <span class="comment">// done here instead of above because it needs to be done when the </span>
  <span class="comment">// robot is connected</span>
  <span class="keywordflow">if</span> (!myPTUInitRequested &amp;&amp;  myRobot-&gt;isConnected())
  {
    printf(<span class="stringliteral">"\nInitializing ArRVision\n"</span>);
    myAbsolute = <span class="keyword">true</span>;
    myPTUInitRequested = <span class="keyword">true</span>;
    myPTU.init();
    question();
  }

<span class="comment">/*</span>
<span class="comment">  // if the camera hasn't initialized yet, then just return</span>
<span class="comment">  if (myPTUInitRequested &amp;&amp; !myPTU.isInitted())</span>
<span class="comment">  {</span>
<span class="comment">    return;</span>
<span class="comment">  }</span>
<span class="comment">*/</span>

<span class="comment">/*</span>
<span class="comment">  if (myPTUInitRequested ) //&amp;&amp; myPTU.isInitted())</span>
<span class="comment">  {</span>
<span class="comment">    myPTUInitRequested = false;</span>
<span class="comment">    printf("Done.\n");</span>
<span class="comment">    question();</span>
<span class="comment">  }</span>
<span class="comment">*/</span>

  <span class="keywordflow">if</span> (myExerciseTime.secSince() &gt; 5 &amp;&amp; myExercise)
  {
    <span class="keywordtype">int</span> pan,tilt;

    <span class="keywordflow">if</span> (<a name="a17"></a><a class="code" href="classArMath.html#a6e0fe8a0dc83eab361e795105f44909">ArMath::random</a>()%2)
      pan = <a class="code" href="classArMath.html#a6e0fe8a0dc83eab361e795105f44909">ArMath::random</a>()%((int)myPTU.getMaxPosPan());
    <span class="keywordflow">else</span>
      pan = -<a class="code" href="classArMath.html#a6e0fe8a0dc83eab361e795105f44909">ArMath::random</a>()%((int)myPTU.getMaxNegPan());

    <span class="keywordflow">if</span> (<a class="code" href="classArMath.html#a6e0fe8a0dc83eab361e795105f44909">ArMath::random</a>()%2)
      tilt = <a class="code" href="classArMath.html#a6e0fe8a0dc83eab361e795105f44909">ArMath::random</a>()%((int)myPTU.getMaxPosTilt());
    <span class="keywordflow">else</span>
      tilt = -<a class="code" href="classArMath.html#a6e0fe8a0dc83eab361e795105f44909">ArMath::random</a>()%((int)myPTU.getMaxNegTilt());

    myPTU.panTilt(pan, tilt);
    <span class="comment">//printf("** %d\n", myRobot-&gt;getEstop());</span>
    <span class="comment">//printf("--&gt; %x\n", myRobot-&gt;getFlags());</span>
    myExerciseTime.setToNow();
  }

}

<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv) 
{
  std::string str;

  <a name="a18"></a><a class="code" href="classAria.html#d99c16b5d947229d9f8e1c5b2d4cdd73" title="Initialize Aria global data struture and perform OS-specific initialization, including...">Aria::init</a>();
  <a name="_a19"></a><a class="code" href="classArArgumentParser.html" title="Class for parsing arguments.">ArArgumentParser</a> parser(&amp;argc, argv);
  <a class="code" href="classArRobot.html" title="Central class for communicating with and operating the robot.">ArRobot</a> robot;
  <a name="_a20"></a><a class="code" href="classArRobotConnector.html">ArRobotConnector</a> con(&amp;parser, &amp;robot);

  KeyPTU ptu(&amp;robot);

  <span class="keywordflow">if</span> (!con.connectRobot())
  {
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"Could not connect to robot... exiting\n"</span>);
    <span class="keywordflow">if</span>(parser.checkHelpAndWarnUnparsed())
      <a name="a21"></a><a class="code" href="classAria.html#10d71f3d4d0cf7f38c58a1f749f64a42" title="Logs all the options for the program (Calls all the callbacks added with addLogOptionsCB())...">Aria::logOptions</a>();
    <a name="a22"></a><a class="code" href="classAria.html#6abc3d39b3e9548063bb8e78375acc17" title="Shutdown all Aria processes/threads, call exit callbacks, and exit the program.">Aria::exit</a>(1);
    <span class="keywordflow">return</span> 1;
  }

  <span class="keywordflow">if</span>(!<a name="a23"></a><a class="code" href="classAria.html#1b090c01d88bb420b8cf8e0384d25ee1" title="Parses the arguments for the program (calls all the callbacks added with addParseArgsCB())...">Aria::parseArgs</a>())
  {
    <a class="code" href="classAria.html#10d71f3d4d0cf7f38c58a1f749f64a42" title="Logs all the options for the program (Calls all the callbacks added with addLogOptionsCB())...">Aria::logOptions</a>();
    <a class="code" href="classAria.html#6abc3d39b3e9548063bb8e78375acc17" title="Shutdown all Aria processes/threads, call exit callbacks, and exit the program.">Aria::exit</a>(1);
  }

  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"connected to robot."</span>);


  robot.<a name="a24"></a><a class="code" href="classArRobot.html#ceef80a6274fb34aafcc422e4b1778c1" title="Sends a command to the robot with an int for argument.">comInt</a>(<a name="a25"></a><a class="code" href="classArCommands.html#9a31f904a95bbc31d8b33c6637100cc4a8d799cced5def80525936119963aad4" title="int, enable (1) or disable (0) motors">ArCommands::ENABLE</a>, 1);
  ptu.power(<span class="keyword">true</span>);

  printf(<span class="stringliteral">"Press '?' for available commands\r\n"</span>);
  robot.<a name="a26"></a><a class="code" href="classArRobot.html#fb40bb581fa61eb08a542840e4264e26" title="Starts the instance to do processing in this thread.">run</a>(<span class="keyword">true</span>);
  
  <a class="code" href="classAria.html#6abc3d39b3e9548063bb8e78375acc17" title="Shutdown all Aria processes/threads, call exit callbacks, and exit the program.">Aria::exit</a>(0);
}

</pre></div> </div>
<hr size="1"><address style="text-align: right;"><small>Generated on Wed Aug 1 12:22:50 2012 for Aria by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
