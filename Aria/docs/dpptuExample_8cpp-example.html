<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Aria: dpptuExample.cpp</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="classes.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>dpptuExample.cpp</h1>Shows how to control the Directed Perception pan-tilt unit.<p>
This program lets you use the keyboard to control the DPPTU. It uses the same acceleration and slew rates for the pan and tilt axes.<p>
Commands: _________________<p>
UP,DOWN -- tilt up/down by one positional increment LEFT,RIGHT -- pan left/right by one positional increment SPACE -- perform reset calibration I -- initialize PTU to default settings &lt;,&gt; -- increase/decrease the posIncrement by 0.5 degree +,- -- increase/decrease the speed by 1 degree/sec A -- awaits the completion of last issued positional command R -- change pan/tilt movements to relative or absolute movements Z -- move pan and tilt axes to zero 1 -- move to stored position 1 (-90, 0) 2 -- move to stored position 2 (90, 0) 3 -- move to stored position 3 (0, -45) 4 -- move to stored position 4 (0, 30) M -- Enter or Exit monitor (continuous scan) mode H -- Halt all motion S -- print current variable values ESC -- quit<p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include "Aria.h"</span>

<span class="comment">// If defined, use this computer serial port. If not defined, use first robot</span>
<span class="comment">// aux. serial port.  Most robots have the DPPTU on COM2 if on Linux and COM4 on</span>
<span class="comment">// Windows, if not equipped with other accessories which might require those</span>
<span class="comment">// ports (e.g. GPS or Laser).</span>
<span class="preprocessor">#define SERIAL_PORT ArUtil::COM4</span>
<span class="preprocessor"></span>

<span class="comment">// Determines type of DPPTU to set internal conversion factors. See enum of</span>
<span class="comment">// types in ArDPPTU class for possible values.</span>
<span class="comment">//#define PTU_TYPE ArDPPTU::PANTILT_PTUD46</span>

<span class="comment">// by how much the &lt; and &gt;  keys change the position command increment in this</span>
<span class="comment">// example</span>
<span class="preprocessor">#define POS_INC_ADJUSTMENT 1</span>
<span class="preprocessor"></span>
<span class="comment">/*</span>
<span class="comment">  This class is the core of this demo, it adds itself to the robot given</span>
<span class="comment">  as a user task, and contains key handler callbacks to control the PTU.</span>
<span class="comment">*/</span>
<span class="keyword">class </span>KeyPTU
{
<span class="keyword">public</span>:
  <span class="comment">// constructor</span>
  KeyPTU(<a name="_a0"></a><a class="code" href="classArRobot.html" title="Central class for communicating with and operating the robot.">ArRobot</a> *robot);
  ~KeyPTU(<span class="keywordtype">void</span>);
  
  <span class="keywordtype">void</span> up(<span class="keywordtype">void</span>);
  <span class="keywordtype">void</span> down(<span class="keywordtype">void</span>);
  <span class="keywordtype">void</span> left(<span class="keywordtype">void</span>);
  <span class="keywordtype">void</span> right(<span class="keywordtype">void</span>);
  <span class="keywordtype">void</span> space(<span class="keywordtype">void</span>);
  <span class="keywordtype">void</span> i(<span class="keywordtype">void</span>);
  <span class="keywordtype">void</span> plus(<span class="keywordtype">void</span>);
  <span class="keywordtype">void</span> minus(<span class="keywordtype">void</span>);
  <span class="keywordtype">void</span> greater(<span class="keywordtype">void</span>);
  <span class="keywordtype">void</span> less(<span class="keywordtype">void</span>);
  <span class="keywordtype">void</span> question(<span class="keywordtype">void</span>);
  <span class="keywordtype">void</span> status(<span class="keywordtype">void</span>);
  <span class="keywordtype">void</span> a(<span class="keywordtype">void</span>);
  <span class="keywordtype">void</span> m(<span class="keywordtype">void</span>);
  <span class="keywordtype">void</span> h(<span class="keywordtype">void</span>);
  <span class="keywordtype">void</span> r(<span class="keywordtype">void</span>);
  <span class="keywordtype">void</span> gotoPos(<span class="keywordtype">double</span> p, <span class="keywordtype">double</span> t);

  <span class="comment">// the callback function</span>
  <span class="keywordtype">void</span> drive(<span class="keywordtype">void</span>);

<span class="keyword">protected</span>:
  <span class="keywordtype">int</span> myPanValPTU;
  <span class="keywordtype">int</span> myTiltValPTU;

  <span class="keywordtype">int</span> myDesiredPanPos;
  <span class="keywordtype">int</span> myDesiredTiltPos;
  <span class="keywordtype">int</span> mySlew;
  <span class="keywordtype">int</span> myPosIncrement;
  <span class="keywordtype">int</span> mySlewIncrement;

  <span class="keywordtype">int</span> POS_INCREMENT_ADJUSTMENT;

  <span class="keywordtype">bool</span> myMonitor;
  <span class="keywordtype">bool</span> myReset;
  <span class="keywordtype">bool</span> myInit;
  <span class="keywordtype">bool</span> myAbsolute;

  <a name="_a1"></a><a class="code" href="classArFunctorC.html" title="Functor for a member function.">ArFunctorC&lt;KeyPTU&gt;</a> myUpCB;
  <a class="code" href="classArFunctorC.html" title="Functor for a member function.">ArFunctorC&lt;KeyPTU&gt;</a> myDownCB;
  <a class="code" href="classArFunctorC.html" title="Functor for a member function.">ArFunctorC&lt;KeyPTU&gt;</a> myLeftCB;
  <a class="code" href="classArFunctorC.html" title="Functor for a member function.">ArFunctorC&lt;KeyPTU&gt;</a> myRightCB;
  <a class="code" href="classArFunctorC.html" title="Functor for a member function.">ArFunctorC&lt;KeyPTU&gt;</a> mySpaceCB;
  <a class="code" href="classArFunctorC.html" title="Functor for a member function.">ArFunctorC&lt;KeyPTU&gt;</a> myICB;
  <a class="code" href="classArFunctorC.html" title="Functor for a member function.">ArFunctorC&lt;KeyPTU&gt;</a> myPlusCB;
  <a class="code" href="classArFunctorC.html" title="Functor for a member function.">ArFunctorC&lt;KeyPTU&gt;</a> myMinusCB;
  <a class="code" href="classArFunctorC.html" title="Functor for a member function.">ArFunctorC&lt;KeyPTU&gt;</a> myGreaterCB;
  <a class="code" href="classArFunctorC.html" title="Functor for a member function.">ArFunctorC&lt;KeyPTU&gt;</a> myLessCB;
  <a class="code" href="classArFunctorC.html" title="Functor for a member function.">ArFunctorC&lt;KeyPTU&gt;</a> myQuestionCB;
  <a class="code" href="classArFunctorC.html" title="Functor for a member function.">ArFunctorC&lt;KeyPTU&gt;</a> mySCB;
  <a class="code" href="classArFunctorC.html" title="Functor for a member function.">ArFunctorC&lt;KeyPTU&gt;</a> myACB;
  <a class="code" href="classArFunctorC.html" title="Functor for a member function.">ArFunctorC&lt;KeyPTU&gt;</a> myMCB;
  <a class="code" href="classArFunctorC.html" title="Functor for a member function.">ArFunctorC&lt;KeyPTU&gt;</a> myHCB;
  <a class="code" href="classArFunctorC.html" title="Functor for a member function.">ArFunctorC&lt;KeyPTU&gt;</a> myRCB;
  <a name="_a2"></a><a class="code" href="classArFunctor2C.html" title="Functor for a member function with 2 parameters.">ArFunctor2C&lt;KeyPTU, double, double&gt;</a> myPos0CB;
  <a class="code" href="classArFunctor2C.html" title="Functor for a member function with 2 parameters.">ArFunctor2C&lt;KeyPTU, double, double&gt;</a> myPos1CB;
  <a class="code" href="classArFunctor2C.html" title="Functor for a member function with 2 parameters.">ArFunctor2C&lt;KeyPTU, double, double&gt;</a> myPos2CB;
  <a class="code" href="classArFunctor2C.html" title="Functor for a member function with 2 parameters.">ArFunctor2C&lt;KeyPTU, double, double&gt;</a> myPos3CB;
  <a class="code" href="classArFunctor2C.html" title="Functor for a member function with 2 parameters.">ArFunctor2C&lt;KeyPTU, double, double&gt;</a> myPos4CB;


  <span class="comment">// the PTU</span>
  <a name="_a3"></a><a class="code" href="classArDPPTU.html" title="Driver for the DPPTU.">ArDPPTU</a> myPTU;
  

  <span class="comment">// whether the PTU has been inited or not</span>
  <span class="keywordtype">bool</span> myPTUInited;
  <span class="comment">// pointer to the robot</span>
  <a class="code" href="classArRobot.html" title="Central class for communicating with and operating the robot.">ArRobot</a> *myRobot;
  <span class="comment">// callback for the drive function</span>
  <a class="code" href="classArFunctorC.html" title="Functor for a member function.">ArFunctorC&lt;KeyPTU&gt;</a> myDriveCB;

  <a name="_a4"></a><a class="code" href="classArSerialConnection.html" title="For connecting to devices through a serial port.">ArSerialConnection</a> *mySerialConnection;
};

<span class="comment">/*</span>
<span class="comment">  Constructor, sets the robot pointer, and some initial values, also note the</span>
<span class="comment">  use of constructor chaining on myPTU and myDriveCB.</span>
<span class="comment">*/</span>
KeyPTU::KeyPTU(<a class="code" href="classArRobot.html" title="Central class for communicating with and operating the robot.">ArRobot</a> *robot) :
  myUpCB(this, &amp;KeyPTU::up),
  myDownCB(this, &amp;KeyPTU::down),
  myLeftCB(this, &amp;KeyPTU::left),
  myRightCB(this, &amp;KeyPTU::right),
  mySpaceCB(this, &amp;KeyPTU::space),
  myICB(this, &amp;KeyPTU::i),
  myPlusCB(this, &amp;KeyPTU::plus),
  myMinusCB(this, &amp;KeyPTU::minus),
  myGreaterCB(this, &amp;KeyPTU::greater),
  myLessCB(this, &amp;KeyPTU::less),
  myQuestionCB(this, &amp;KeyPTU::question),
  mySCB(this, &amp;KeyPTU::status),
  myACB(this, &amp;KeyPTU::a),
  myMCB(this, &amp;KeyPTU::m),
  myHCB(this, &amp;KeyPTU::h),
  myRCB(this, &amp;KeyPTU::r),
  myPos0CB(this, &amp;KeyPTU::gotoPos, 0, 0),
  myPos1CB(this, &amp;KeyPTU::gotoPos, -90.0, 0.0),
  myPos2CB(this, &amp;KeyPTU::gotoPos, 90.0, 0.0),
  myPos3CB(this, &amp;KeyPTU::gotoPos, 0.0, -45.0),
  myPos4CB(this, &amp;KeyPTU::gotoPos, 0.0, 30.0),
  myPTU(robot),
  myDriveCB(this, &amp;KeyPTU::drive),
  mySerialConnection(NULL)
{
<span class="preprocessor">#ifdef SERIAL_PORT</span>
<span class="preprocessor"></span>  mySerialConnection = <span class="keyword">new</span> <a class="code" href="classArSerialConnection.html" title="For connecting to devices through a serial port.">ArSerialConnection</a>;
  <a name="a5"></a><a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a name="a6"></a><a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"dpptuExample: connecting to DPPTU over computer serial port %s."</span>, SERIAL_PORT);
  <span class="keywordflow">if</span>(mySerialConnection-&gt;open(SERIAL_PORT) != 0)
  {
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a name="a7"></a><a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>, <span class="stringliteral">"dpptuExample: Error: Could not open computer serial port %s for DPPTU!"</span>, SERIAL_PORT);
    <a name="a8"></a><a class="code" href="classAria.html#6abc3d39b3e9548063bb8e78375acc17" title="Shutdown all Aria processes/threads, call exit callbacks, and exit the program.">Aria::exit</a>(5);
  }
  myPTU.setDeviceConnection(mySerialConnection);
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>
  <span class="comment">// set the robot pointer and add the KeyPTU as user task</span>
  <a name="_a9"></a><a class="code" href="classArKeyHandler.html" title="Perform actions when keyboard keys are pressed.">ArKeyHandler</a> *keyHandler;
  myRobot = robot;
  myRobot-&gt;<a name="a10"></a><a class="code" href="classArRobot.html#b3ed1a09a96c009802ed64bbc6c75325" title="Adds a task under the sensor interp part of the syncronous tasks.">addSensorInterpTask</a>(<span class="stringliteral">"KeyPTU"</span>, 50, &amp;myDriveCB);

  <span class="keywordflow">if</span> ((keyHandler = <a name="a11"></a><a class="code" href="classAria.html#5b8042b38b19d6a5d3cfbed4df483e67" title="Gets a pointer to the global key handler, if one has been set with setKeyHandler()...">Aria::getKeyHandler</a>()) == NULL)
  {
    keyHandler = <span class="keyword">new</span> <a class="code" href="classArKeyHandler.html" title="Perform actions when keyboard keys are pressed.">ArKeyHandler</a>;
    <a name="a12"></a><a class="code" href="classAria.html#9e5496a4ec2c379c8e18706922b57cc1" title="Sets the key handler, so that other classes can find it using getKeyHandler().">Aria::setKeyHandler</a>(keyHandler);
    myRobot-&gt;attachKeyHandler(keyHandler);
  }

  <span class="keywordflow">if</span> (!keyHandler-&gt;<a name="a13"></a><a class="code" href="classArKeyHandler.html#d5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<a name="a14"></a><a class="code" href="classArKeyHandler.html#665246cd772590dd02ea299dd047899c8a1d3905f01b5d27603bb0528912d341" title="Up arrow (keypad or 4 key dirs).">ArKeyHandler::UP</a>, &amp;myUpCB))
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>, <span class="stringliteral">"The key handler already has a key for up, keydrive will not work correctly."</span>);
  <span class="keywordflow">if</span> (!keyHandler-&gt;<a class="code" href="classArKeyHandler.html#d5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<a name="a15"></a><a class="code" href="classArKeyHandler.html#665246cd772590dd02ea299dd047899cb3ecf95789d8f87444856e278393b4d9" title="Down arrow (keypad or 4 key dirs).">ArKeyHandler::DOWN</a>, &amp;myDownCB))
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>, <span class="stringliteral">"The key handler already has a key for down, keydrive will not work correctly."</span>);
  <span class="keywordflow">if</span> (!keyHandler-&gt;<a class="code" href="classArKeyHandler.html#d5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<a name="a16"></a><a class="code" href="classArKeyHandler.html#665246cd772590dd02ea299dd047899c4484301bbabab1fb37e72cbcd6e3e45b" title="Left arrow (keypad or 4 key dirs).">ArKeyHandler::LEFT</a>, &amp;myLeftCB))
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>,  
<span class="stringliteral">"The key handler already has a key for left, keydrive will not work correctly."</span>);
  <span class="keywordflow">if</span> (!keyHandler-&gt;<a class="code" href="classArKeyHandler.html#d5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<a name="a17"></a><a class="code" href="classArKeyHandler.html#665246cd772590dd02ea299dd047899c220c952e7e336650ee7b3e0905971ede" title="Right arrow (keypad or 4 key dirs).">ArKeyHandler::RIGHT</a>, &amp;myRightCB))
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>,  
<span class="stringliteral">"The key handler already has a key for right, keydrive will not work correctly."</span>);
  <span class="keywordflow">if</span> (!keyHandler-&gt;<a class="code" href="classArKeyHandler.html#d5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<a name="a18"></a><a class="code" href="classArKeyHandler.html#665246cd772590dd02ea299dd047899cc7e8d225519fc03645b49532ad11c880" title="Space key.">ArKeyHandler::SPACE</a>, &amp;mySpaceCB))
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>,
<span class="stringliteral">"The key handler already has a key for space, keydrive will not work correctly."</span>);
  <span class="keywordflow">if</span> (!keyHandler-&gt;<a class="code" href="classArKeyHandler.html#d5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<span class="charliteral">'i'</span>, &amp;myICB))
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>,
<span class="stringliteral">"The key handler already has a key for 'i', keydrive will not work correctly."</span>);
  <span class="keywordflow">if</span> (!keyHandler-&gt;<a class="code" href="classArKeyHandler.html#d5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<span class="charliteral">'+'</span>, &amp;myPlusCB))
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>,
<span class="stringliteral">"The key handler already has a key for '+', keydrive will not work correctly."</span>);
  <span class="keywordflow">if</span> (!keyHandler-&gt;<a class="code" href="classArKeyHandler.html#d5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<span class="charliteral">'-'</span>, &amp;myMinusCB))
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>,
<span class="stringliteral">"The key handler already has a key for '-', keydrive will not work correctly."</span>);
  <span class="keywordflow">if</span> (!keyHandler-&gt;<a class="code" href="classArKeyHandler.html#d5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<span class="charliteral">'&gt;'</span>, &amp;myGreaterCB))
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>,
<span class="stringliteral">"The key handler already has a key for '&gt;', keydrive will not work correctly."</span>);
  <span class="keywordflow">if</span> (!keyHandler-&gt;<a class="code" href="classArKeyHandler.html#d5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<span class="charliteral">'&lt;'</span>, &amp;myLessCB))
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>,
<span class="stringliteral">"The key handler already has a key for '&lt;', keydrive will not work correctly."</span>);
  <span class="keywordflow">if</span> (!keyHandler-&gt;<a class="code" href="classArKeyHandler.html#d5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<span class="charliteral">'?'</span>, &amp;myQuestionCB))
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>,
<span class="stringliteral">"The key handler already has a key for '?', keydrive will not work correctly."</span>);
  <span class="keywordflow">if</span> (!keyHandler-&gt;<a class="code" href="classArKeyHandler.html#d5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<span class="charliteral">'s'</span>, &amp;mySCB))
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>,
<span class="stringliteral">"The key handler already has a key for 'S', keydrive will not work correctly."</span>);
  <span class="keywordflow">if</span> (!keyHandler-&gt;<a class="code" href="classArKeyHandler.html#d5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<span class="charliteral">'a'</span>, &amp;myACB))
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>,
<span class="stringliteral">"The key handler already has a key for 'A', keydrive will not work correctly."</span>);
  <span class="keywordflow">if</span> (!keyHandler-&gt;<a class="code" href="classArKeyHandler.html#d5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<span class="charliteral">'z'</span>, &amp;myPos0CB))
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>,
<span class="stringliteral">"The key handler already has a key for 'Z', keydrive will not work correctly."</span>);
  <span class="keywordflow">if</span> (!keyHandler-&gt;<a class="code" href="classArKeyHandler.html#d5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<span class="charliteral">'m'</span>, &amp;myMCB))
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>,
<span class="stringliteral">"The key handler already has a key for 'M', keydrive will not work correctly."</span>);
  <span class="keywordflow">if</span> (!keyHandler-&gt;<a class="code" href="classArKeyHandler.html#d5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<span class="charliteral">'h'</span>, &amp;myHCB))
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>,
<span class="stringliteral">"The key handler already has a key for 'H', keydrive will not work correctly."</span>);
  <span class="keywordflow">if</span> (!keyHandler-&gt;<a class="code" href="classArKeyHandler.html#d5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<span class="charliteral">'r'</span>, &amp;myRCB))
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>,
<span class="stringliteral">"The key handler already has a key for 'R', keydrive will not work correctly."</span>);


  <span class="keywordflow">if</span>(!keyHandler-&gt;<a class="code" href="classArKeyHandler.html#d5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<span class="charliteral">'Z'</span>, &amp;myPos0CB))
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>, 
<span class="stringliteral">"The key handler already has a key for 'Z', keydrive will not work correctly."</span>);

  <span class="keywordflow">if</span>(!keyHandler-&gt;<a class="code" href="classArKeyHandler.html#d5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<span class="charliteral">'1'</span>, &amp;myPos1CB))
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>, 
<span class="stringliteral">"The key handler already has a key for '1', keydrive will not work correctly."</span>);

  <span class="keywordflow">if</span>(!keyHandler-&gt;<a class="code" href="classArKeyHandler.html#d5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<span class="charliteral">'2'</span>, &amp;myPos2CB))
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>, 
<span class="stringliteral">"The key handler already has a key for '2', keydrive will not work correctly."</span>);

  <span class="keywordflow">if</span>(!keyHandler-&gt;<a class="code" href="classArKeyHandler.html#d5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<span class="charliteral">'3'</span>, &amp;myPos3CB))
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>, 
<span class="stringliteral">"The key handler already has a key for '3', keydrive will not work correctly."</span>);

  <span class="keywordflow">if</span>(!keyHandler-&gt;<a class="code" href="classArKeyHandler.html#d5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<span class="charliteral">'4'</span>, &amp;myPos4CB))
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>, 
<span class="stringliteral">"The key handler already has a key for '4', keydrive will not work correctly."</span>);

  <span class="comment">// initialize some variables</span>
  myReset = <span class="keyword">false</span>;
  myInit = <span class="keyword">true</span>;
  myDesiredPanPos = 0;
  myDesiredTiltPos = 0;
  myPosIncrement = 1;
  mySlewIncrement = 1;
  myPTUInited = <span class="keyword">false</span>;
  myMonitor = <span class="keyword">false</span>;

}

KeyPTU::~KeyPTU() 
{
  <span class="keywordflow">if</span>(mySerialConnection)
  {
    myPTU.setDeviceConnection(NULL);
    <span class="keyword">delete</span> mySerialConnection;
  }
}



<span class="keywordtype">void</span> KeyPTU::left(<span class="keywordtype">void</span>)
{
  myDesiredPanPos += myPosIncrement;

  <span class="keywordflow">if</span> (myDesiredPanPos &gt; myPTU.getMaxPosPan())
    myDesiredPanPos = myPTU.getMaxPosPan();
}

<span class="keywordtype">void</span> KeyPTU::right(<span class="keywordtype">void</span>)
{
  myDesiredPanPos -= myPosIncrement;

  <span class="keywordflow">if</span> (myDesiredPanPos &lt; myPTU.getMaxNegPan())
    myDesiredPanPos = myPTU.getMaxNegPan();
}

<span class="keywordtype">void</span> KeyPTU::up(<span class="keywordtype">void</span>)
{
  myDesiredTiltPos += myPosIncrement;
 
  <span class="keywordflow">if</span> (myDesiredTiltPos &gt; myPTU.getMaxPosTilt())
    myDesiredTiltPos = myPTU.getMaxPosTilt();
}

<span class="keywordtype">void</span> KeyPTU::down(<span class="keywordtype">void</span>)
{
  myDesiredTiltPos -= myPosIncrement;

  <span class="keywordflow">if</span> (myDesiredTiltPos &lt; myPTU.getMaxNegTilt())
    myDesiredTiltPos = myPTU.getMaxNegTilt();
}

<span class="keywordtype">void</span> KeyPTU::space(<span class="keywordtype">void</span>)
{
  myReset = <span class="keyword">true</span>;
}

<span class="keywordtype">void</span> KeyPTU::i(<span class="keywordtype">void</span>)
{
  myInit = <span class="keyword">true</span>;
}

<span class="keywordtype">void</span> KeyPTU::plus(<span class="keywordtype">void</span>)
{
  mySlew += mySlewIncrement;

  <span class="keywordflow">if</span> (mySlew &gt; myPTU.getMaxPanSlew())
    mySlew = myPTU.getMaxPanSlew();

  status();
}

<span class="keywordtype">void</span> KeyPTU::minus(<span class="keywordtype">void</span>)
{
  mySlew -= mySlewIncrement;

  <span class="keywordflow">if</span> (mySlew &lt; myPTU.getMinPanSlew())
    mySlew = myPTU.getMinPanSlew();

  status();
}

<span class="keywordtype">void</span> KeyPTU::greater(<span class="keywordtype">void</span>)
{
  myPosIncrement += POS_INCREMENT_ADJUSTMENT;
  
  <span class="keywordflow">if</span> (myPosIncrement &gt; myPTU.getMaxPosPan())
    myPosIncrement = myPTU.getMaxPosPan();

  status();
}

<span class="keywordtype">void</span> KeyPTU::less(<span class="keywordtype">void</span>)
{
  myPosIncrement -= POS_INCREMENT_ADJUSTMENT;

  <span class="keywordflow">if</span> (myPosIncrement &lt; 0)
    myPosIncrement = 0;

  status();
}

<span class="keywordtype">void</span> KeyPTU::a(<span class="keywordtype">void</span>)
{
  myPTU.awaitExec();   
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"AwaitExecution command sent"</span>);
}

<span class="keywordtype">void</span> KeyPTU::gotoPos(<span class="keywordtype">double</span> p, <span class="keywordtype">double</span> t)
{
  myDesiredPanPos = p;
  myDesiredTiltPos = t;
  status();
}

<span class="keywordtype">void</span> KeyPTU::question(<span class="keywordtype">void</span>)
{
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"\r\nCommands:\r\n_________________\r\n"</span>);
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"UP,DOWN    -- tilt up/down by one positional increment"</span>);
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"LEFT,RIGHT -- pan left/right by one positional increment"</span>);
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"SPACE      -- perform reset calibration"</span>);
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"I          -- initialize PTU to default settings"</span>);
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"&lt;,&gt;        -- increase/decrease the posIncrement by %f degree(s)"</span>, POS_INC_ADJUSTMENT);
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"+,-        -- increase/decrease the speed by 1 degree/sec"</span>);
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"A          -- awaits the completion of last issued positional command"</span>);
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"R          -- change pan/tilt movements to relative or absolute movements"</span>);
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"Z          -- move pan and tilt axes to zero"</span>);
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"1          -- move to stored position 1 (-90, 0)"</span>);
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"2          -- move to stored position 2 (90, 0)"</span>);
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"3          -- move to stored position 3 (0, -45)"</span>);
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"4          -- move to stored position 4 (0, 30)"</span>);
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"M          -- Enter or Exit monitor (continuous scan) mode"</span>);
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"H          -- Halt all motion"</span>);
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"S          -- print current variable values"</span>);
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"ESC        -- exit program"</span>);
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"\r\n"</span>);
}

<span class="keywordtype">void</span> KeyPTU::status(<span class="keywordtype">void</span>)
{
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"\r\nStatus:\r\n_________________\r\n"</span>);
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"Last Pan Command      = %.1f deg"</span>, myPTU.getLastPanRequest());
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"Last Tilt Command      = %.1f deg"</span>, myPTU.getLastTiltRequest());
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"Current Pan Position  = %.1f deg"</span>, myPTU.getPan());
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"Current Tilt Position = %.1f deg"</span>, myPTU.getTilt());
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"Pan Slew Rate         = %d deg/sec"</span>, myPTU.getPanSlew());
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"Tilt Slew Rate        = %d deg/sec"</span>, myPTU.getTiltSlew());
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"Position Increment    = %d deg"</span>, myPosIncrement);
  <span class="keywordflow">if</span> (myAbsolute)
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"Positional-movements using absolute commands"</span>);
  <span class="keywordflow">else</span>
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"Positional-movements using relative commands"</span>);
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"\r\n"</span>);
}

<span class="keywordtype">void</span> KeyPTU::m(<span class="keywordtype">void</span>)
{
  <span class="keywordflow">if</span> (!myMonitor)
  {
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"Entering Monitor mode - hit 'M' to disable"</span>);
    myMonitor = <span class="keyword">true</span>;
    myPTU.initMon(-60,60,30,-30);
  }
  <span class="keywordflow">else</span>
  {
    myPTU.blank();  <span class="comment">//Blank packet exits monitor mode</span>
    myMonitor = <span class="keyword">false</span>;
  }
}

<span class="keywordtype">void</span> KeyPTU::h(<span class="keywordtype">void</span>)
{
  myPTU.haltAll();
}

<span class="keywordtype">void</span> KeyPTU::r(<span class="keywordtype">void</span>)
{
  <span class="keywordflow">if</span> (!myAbsolute)
  {
    myAbsolute = <span class="keyword">true</span>;
  }
  <span class="keywordflow">else</span>
  {
    myAbsolute = <span class="keyword">false</span>;
  }
  status();
}


<span class="comment">// the important function</span>
<span class="keywordtype">void</span> KeyPTU::drive(<span class="keywordtype">void</span>)
{

  <span class="comment">// if the PTU isn't initialized, initialize it here... it has to be </span>
  <span class="comment">// done here instead of above because it needs to be done when the </span>
  <span class="comment">// robot is connected</span>
  <span class="keywordflow">if</span> (!myPTUInited &amp;&amp; myRobot-&gt;isConnected())
  {
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"Initializing ArDPPTU..."</span>);
    myPTU.init();
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"Resetting PTU and performing self-calibration..."</span>);
    myPTU.resetCalib();
    myPTU.awaitExec(); <span class="comment">// DPPTU will wait for self-calibration to end before executing the following commands (though they will still be sent)</span>
    mySlew = myPTU.getPanSlew(); <span class="comment">//uses only pan slew rate</span>
    myPTU.awaitExec();
    myPTUInited = <span class="keyword">true</span>;
    myInit = <span class="keyword">false</span>;
    myAbsolute = <span class="keyword">true</span>;
  }

  <span class="keywordflow">if</span> (myInit == <span class="keyword">true</span>)  <span class="comment">// User hit initialization key</span>
  {
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"Initializing PTU..."</span>);
    myPTU.init();
    myInit = <span class="keyword">false</span>;
    myDesiredPanPos = myPTU.getPan();
    myDesiredTiltPos = myPTU.getTilt();
    mySlew = myPTU.getPanSlew(); <span class="comment">//uses only pan slew rate</span>
    myReset = <span class="keyword">false</span>;
  }

  <span class="keywordflow">if</span> (myReset == <span class="keyword">true</span>) <span class="comment">// User hit reset key</span>
  {
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"Resetting PTU and performing self-calibration..."</span>);
    myPTU.resetCalib();
    myPTU.awaitExec();
    myDesiredPanPos = myPTU.getPan();
    myDesiredTiltPos = myPTU.getTilt();
    myReset = <span class="keyword">false</span>;
  }
  <span class="keywordflow">else</span>   <span class="comment">// User did nothing, or hit a key that changed myDesiredPanPos, myDesiredTiltPos, or mySlew (so request PTU to move if those changed since last request)</span>
  {

    <span class="comment">// Some PTUs can determine their current position (with encoders, etc) and return that.</span>
    <span class="comment">// canGetRealPanTilt() will return true in this case, and getPan() and</span>
    <span class="comment">// getTilt() will return those received values.  Otherwise, getPan() and</span>
    <span class="comment">// getTilt() return the last commanded values.  getLastPanRequest() and</span>
    <span class="comment">// getLastTiltRequest() will always return the last commanded values sent by</span>
    <span class="comment">// ArDPPTU (so in the case that canGetRealPanTilt() is false, getPan() and</span>
    <span class="comment">// getTilt() return the same pair of values as getLastPanRequest() and</span>
    <span class="comment">// getLastTiltRequest().  ArDPPTU::canGetRealPanTilt() is initialally false,</span>
    <span class="comment">// but once the first set of pan and tilt positions is read back from the</span>
    <span class="comment">// PTU device, it becomes true.  </span>
    <span class="keywordflow">if</span>(myPTU.canGetRealPanTilt())
      printf(<span class="stringliteral">"Position (%.1f deg, %.1f deg)     [Incr. %d deg]     Press ? for help  \r"</span>, myPTU.getPan(), myPTU.getTilt(), myPosIncrement);
    <span class="keywordflow">else</span>
      printf(<span class="stringliteral">"Requested (%.1f deg, %.1f deg)     [Incr. %d deg]     Press ? for help  \r"</span>, myPTU.getPan(), myPTU.getTilt(), myPosIncrement);

    <span class="keywordflow">if</span> (myDesiredPanPos != myPTU.getLastPanRequest())
    {
      <span class="keywordflow">if</span> (myAbsolute)
        myPTU.pan(myDesiredPanPos);
      <span class="keywordflow">else</span>
        myPTU.panRel(myDesiredPanPos - myPTU.getPan());
    }

    <span class="keywordflow">if</span> (myDesiredTiltPos != myPTU.getLastTiltRequest())
    {
      <span class="keywordflow">if</span> (myAbsolute)
        myPTU.tilt(myDesiredTiltPos);
      <span class="keywordflow">else</span>
        myPTU.tiltRel(myDesiredTiltPos - myPTU.getTilt());
    }

    <span class="keywordflow">if</span> (mySlew != myPTU.getPanSlew())
    {
      myPTU.panSlew(mySlew);
      myPTU.tiltSlew(mySlew);
    }

  }

}

<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv) 
{
    <a name="a19"></a><a class="code" href="classAria.html#d99c16b5d947229d9f8e1c5b2d4cdd73" title="Initialize Aria global data struture and perform OS-specific initialization, including...">Aria::init</a>();
    <a name="_a20"></a><a class="code" href="classArArgumentParser.html" title="Class for parsing arguments.">ArArgumentParser</a> parser(&amp;argc, argv);
    parser.loadDefaultArguments();
    <a class="code" href="classArRobot.html" title="Central class for communicating with and operating the robot.">ArRobot</a> robot;
    <a name="_a21"></a><a class="code" href="classArRobotConnector.html">ArRobotConnector</a> robotConnector(&amp;parser, &amp;robot);
    <span class="keywordflow">if</span>(!robotConnector.connectRobot())
    {
      <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>, <span class="stringliteral">"dpptuExample: Could not connect to the robot."</span>);
      <span class="keywordflow">if</span>(parser.checkHelpAndWarnUnparsed())
      {
          <a name="a22"></a><a class="code" href="classAria.html#10d71f3d4d0cf7f38c58a1f749f64a42" title="Logs all the options for the program (Calls all the callbacks added with addLogOptionsCB())...">Aria::logOptions</a>();
          <a class="code" href="classAria.html#6abc3d39b3e9548063bb8e78375acc17" title="Shutdown all Aria processes/threads, call exit callbacks, and exit the program.">Aria::exit</a>(1);
      }
    }
    <span class="keywordflow">if</span> (!<a name="a23"></a><a class="code" href="classAria.html#1b090c01d88bb420b8cf8e0384d25ee1" title="Parses the arguments for the program (calls all the callbacks added with addParseArgsCB())...">Aria::parseArgs</a>() || !parser.checkHelpAndWarnUnparsed())
    {
      <a class="code" href="classAria.html#10d71f3d4d0cf7f38c58a1f749f64a42" title="Logs all the options for the program (Calls all the callbacks added with addLogOptionsCB())...">Aria::logOptions</a>();
      <a class="code" href="classAria.html#6abc3d39b3e9548063bb8e78375acc17" title="Shutdown all Aria processes/threads, call exit callbacks, and exit the program.">Aria::exit</a>(1);
    }
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"dpptuExample: Connected to robot."</span>);

  robot.<a name="a24"></a><a class="code" href="classArRobot.html#79199f70fee00e4e4a66452d1bbea19b" title="Starts the instance to do processing in its own new thread.">runAsync</a>(<span class="keyword">true</span>);

  <span class="comment">// an object for keyboard control, class defined above, this also adds itself as a user task</span>
  KeyPTU ptu(&amp;robot);


  <span class="comment">// turn off the sonar</span>
  robot.<a name="a25"></a><a class="code" href="classArRobot.html#ceef80a6274fb34aafcc422e4b1778c1" title="Sends a command to the robot with an int for argument.">comInt</a>(<a name="a26"></a><a class="code" href="classArCommands.html#9a31f904a95bbc31d8b33c6637100cc4891b21e6cabc8a2296c8bceca20be779" title="int, enable (1) or disable (0) sonar">ArCommands::SONAR</a>, 0);

  printf(<span class="stringliteral">"Press '?' for available commands\r\n"</span>);

  <span class="comment">// run, if we lose connection to the robot, exit</span>
  robot.<a name="a27"></a><a class="code" href="classArRobot.html#95201be7c39b521983b51e6f5d9303e4" title="Suspend calling thread until the ArRobot run loop has exited.">waitForRunExit</a>();

  <a class="code" href="classAria.html#6abc3d39b3e9548063bb8e78375acc17" title="Shutdown all Aria processes/threads, call exit callbacks, and exit the program.">Aria::exit</a>(0);
}

</pre></div> </div>
<hr size="1"><address style="text-align: right;"><small>Generated on Wed Aug 1 12:22:50 2012 for Aria by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
