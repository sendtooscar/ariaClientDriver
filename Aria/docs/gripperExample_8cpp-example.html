<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Aria: gripperExample.cpp</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="classes.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>gripperExample.cpp</h1>Example program demonstrating use of the Pioneer gripper.<p>
Shows how to control the Pioneer 2DOF gripper accessory. In addition to the arrow keys to teleoperate the robot, Use the following keyboard keys to control it: u Lift the gripper up d Lift the gripper down o Open the gripper c Close the gripper s Stop gripper movement.<p>
<dl class="see" compact><dt><b>See also:</b></dt><dd><a class="el" href="classArModeGripper.html" title="Mode for controlling the gripper.">ArModeGripper</a> (the gripper control mode used in the "demo" program)</dd></dl>
<div class="fragment"><pre class="fragment">
<span class="preprocessor">#include "Aria.h"</span>

<span class="comment">// Adds robot callback to print gripper status.</span>
<span class="keyword">class </span>PrintGripStatus
{
  <a name="_a0"></a><a class="code" href="classArGripper.html" title="Provides an interface to the Pioneer gripper device.">ArGripper</a>* myGripper;
  <a name="_a1"></a><a class="code" href="classArFunctorC.html" title="Functor for a member function.">ArFunctorC&lt;PrintGripStatus&gt;</a> myPrintCB;
<span class="keyword">public</span>:
  PrintGripStatus(<a class="code" href="classArGripper.html" title="Provides an interface to the Pioneer gripper device.">ArGripper</a>* gripper) : 
    myGripper(gripper),
    myPrintCB(<span class="keyword">this</span>, &amp;PrintGripStatus::printStatus)
  {
  }

  <span class="keywordtype">void</span> addRobotTask(<a name="_a2"></a><a class="code" href="classArRobot.html" title="Central class for communicating with and operating the robot.">ArRobot</a>* robot)
  {
    robot-&gt;<a name="a3"></a><a class="code" href="classArRobot.html#50070f4e19b91aaac20772d15d9ad805" title="Adds a user task to the list of synchronous taskes.">addUserTask</a>(<span class="stringliteral">"PrintGripStatus"</span>, 10, &amp;myPrintCB);
  }

  <span class="keywordtype">void</span> printStatus()
  {
    myGripper-&gt;logState();
  }
};

<span class="comment">// Adds key handler callbacks for controlling the gripper</span>
<span class="keyword">class </span>GripperControlHandler
{
  <a class="code" href="classArGripper.html" title="Provides an interface to the Pioneer gripper device.">ArGripper</a>* myGripper;
  <a class="code" href="classArFunctorC.html" title="Functor for a member function.">ArFunctorC&lt;GripperControlHandler&gt;</a> myUpCB;
  <a class="code" href="classArFunctorC.html" title="Functor for a member function.">ArFunctorC&lt;GripperControlHandler&gt;</a> myDownCB;
  <a class="code" href="classArFunctorC.html" title="Functor for a member function.">ArFunctorC&lt;GripperControlHandler&gt;</a> myOpenCB;
  <a class="code" href="classArFunctorC.html" title="Functor for a member function.">ArFunctorC&lt;GripperControlHandler&gt;</a> myCloseCB;
  <a class="code" href="classArFunctorC.html" title="Functor for a member function.">ArFunctorC&lt;GripperControlHandler&gt;</a> myStopCB;
<span class="keyword">public</span>:
  GripperControlHandler(<a class="code" href="classArGripper.html" title="Provides an interface to the Pioneer gripper device.">ArGripper</a>* gripper) : 
    myGripper(gripper),
    myUpCB(this, &amp;GripperControlHandler::liftUp),
    myDownCB(this, &amp;GripperControlHandler::liftDown),
    myOpenCB(this, &amp;GripperControlHandler::open),
    myCloseCB(this, &amp;GripperControlHandler::close),
    myStopCB(this, &amp;GripperControlHandler::stop)
  {
  }

  <span class="keywordtype">void</span> addKeyHandlers(<a class="code" href="classArRobot.html" title="Central class for communicating with and operating the robot.">ArRobot</a> *robot)
  {
    <a name="_a4"></a><a class="code" href="classArKeyHandler.html" title="Perform actions when keyboard keys are pressed.">ArKeyHandler</a> *keyHandler = <a name="a5"></a><a class="code" href="classAria.html#5b8042b38b19d6a5d3cfbed4df483e67" title="Gets a pointer to the global key handler, if one has been set with setKeyHandler()...">Aria::getKeyHandler</a>();
    <span class="keywordflow">if</span>(keyHandler == NULL)
    {
      keyHandler = <span class="keyword">new</span> <a class="code" href="classArKeyHandler.html" title="Perform actions when keyboard keys are pressed.">ArKeyHandler</a>();
      <a name="a6"></a><a class="code" href="classAria.html#9e5496a4ec2c379c8e18706922b57cc1" title="Sets the key handler, so that other classes can find it using getKeyHandler().">Aria::setKeyHandler</a>(keyHandler);
      robot-&gt;<a name="a7"></a><a class="code" href="classArRobot.html#b4ea516667d2358f35b435d97b616ab1" title="Attachs a key handler.">attachKeyHandler</a>(keyHandler);
    }
    keyHandler-&gt;<a name="a8"></a><a class="code" href="classArKeyHandler.html#d5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<a name="a9"></a><a class="code" href="classArKeyHandler.html#665246cd772590dd02ea299dd047899c0a916e5fd9baf9ed01442a1e0d996f9c" title="Page Up (not supported on Windows yet).">ArKeyHandler::PAGEUP</a>, &amp;myUpCB);
    keyHandler-&gt;<a class="code" href="classArKeyHandler.html#d5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<span class="charliteral">'u'</span>, &amp;myUpCB);
    keyHandler-&gt;<a class="code" href="classArKeyHandler.html#d5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<a name="a10"></a><a class="code" href="classArKeyHandler.html#665246cd772590dd02ea299dd047899cabbedf3b93d1e2a1f09298be2dbeca30" title="Page Down (not supported on Windows yet).">ArKeyHandler::PAGEDOWN</a>, &amp;myDownCB);
    keyHandler-&gt;<a class="code" href="classArKeyHandler.html#d5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<span class="charliteral">'d'</span>, &amp;myDownCB);
    keyHandler-&gt;<a class="code" href="classArKeyHandler.html#d5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<span class="charliteral">'o'</span>, &amp;myOpenCB);
    keyHandler-&gt;<a class="code" href="classArKeyHandler.html#d5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<span class="charliteral">'c'</span>, &amp;myCloseCB);
    keyHandler-&gt;<a class="code" href="classArKeyHandler.html#d5442ebb21cd242ab168e94686e06759" title="This adds a keyhandler, when the keyToHandle is hit, functor will fire.">addKeyHandler</a>(<span class="charliteral">'s'</span>, &amp;myStopCB);
  }

  <span class="keywordtype">void</span> liftUp()
  {
    <a name="a11"></a><a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a name="a12"></a><a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"Moving gripper lift up..."</span>);
    myGripper-&gt;liftUp();
  }

  <span class="keywordtype">void</span> liftDown()
  {
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"Moving gripper lift down..."</span>);
    myGripper-&gt;liftDown();
  }

  <span class="keywordtype">void</span> stop()
  {
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"Stopping gripper..."</span>);
    myGripper-&gt;gripperHalt(); <span class="comment">// stops both lift an grip</span>
    <span class="comment">//myGripper-&gt;liftStop(); // stops just the lift</span>
    <span class="comment">//myGripper-&gt;gripStop(); // stops just the gripper</span>
  }

  <span class="keywordtype">void</span> close()
  {
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"Closing gripper..."</span>);
    myGripper-&gt;gripClose();
  }

  <span class="keywordtype">void</span> open()
  {
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"Opening gripper..."</span>);
    myGripper-&gt;gripOpen();
  }

};

<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv) 
{

  <a name="a13"></a><a class="code" href="classAria.html#d99c16b5d947229d9f8e1c5b2d4cdd73" title="Initialize Aria global data struture and perform OS-specific initialization, including...">Aria::init</a>();
  <a class="code" href="classArRobot.html" title="Central class for communicating with and operating the robot.">ArRobot</a> robot;
  <a name="_a14"></a><a class="code" href="classArArgumentParser.html" title="Class for parsing arguments.">ArArgumentParser</a> argParser(&amp;argc, argv);
  <a name="_a15"></a><a class="code" href="classArSimpleConnector.html" title="Legacy connector for robot and laser.">ArSimpleConnector</a> connector(&amp;argParser);
  <a class="code" href="classArGripper.html" title="Provides an interface to the Pioneer gripper device.">ArGripper</a> gripper(&amp;robot);
  <a name="_a16"></a><a class="code" href="classArSonarDevice.html" title="Keep track of recent sonar readings from a robot as an ArRangeDevice.">ArSonarDevice</a> sonar;
  robot.<a name="a17"></a><a class="code" href="classArRobot.html#97d57b28549fdef851c00749a97cc776" title="Adds a rangeDevice to the robot&amp;#39;s list of them, and set the device&amp;#39;s robot...">addRangeDevice</a>(&amp;sonar);

  argParser.loadDefaultArguments();

  <span class="keywordflow">if</span> (!<a name="a18"></a><a class="code" href="classAria.html#1b090c01d88bb420b8cf8e0384d25ee1" title="Parses the arguments for the program (calls all the callbacks added with addParseArgsCB())...">Aria::parseArgs</a>() || !argParser.checkHelpAndWarnUnparsed())
  {
    <a name="a19"></a><a class="code" href="classAria.html#10d71f3d4d0cf7f38c58a1f749f64a42" title="Logs all the options for the program (Calls all the callbacks added with addLogOptionsCB())...">Aria::logOptions</a>();
    <a name="a20"></a><a class="code" href="classAria.html#6abc3d39b3e9548063bb8e78375acc17" title="Shutdown all Aria processes/threads, call exit callbacks, and exit the program.">Aria::exit</a>(1);
    <span class="keywordflow">return</span> 1;
  }
  
  <span class="keywordflow">if</span> (!connector.connectRobot(&amp;robot))
  {
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a name="a21"></a><a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>, <span class="stringliteral">"gripperExample: Could not connect to robot... exiting"</span>);
    <a class="code" href="classAria.html#6abc3d39b3e9548063bb8e78375acc17" title="Shutdown all Aria processes/threads, call exit callbacks, and exit the program.">Aria::exit</a>(2);
    <span class="keywordflow">return</span> 2;
  }
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"gripperExample: Connected to robot."</span>);

  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"gripperExample: GripperType=%d"</span>, gripper.getType());
  gripper.logState();
  <span class="keywordflow">if</span>(gripper.getType() == <a name="a22"></a><a class="code" href="classArGripper.html#565fcee58e47e92596e472c34f359368e1f5be72993ec3d941480086a6948e57" title="There isn&amp;#39;t a gripper.">ArGripper::NOGRIPPER</a>)
  {
    <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce3012daf6573594f91242f8dd7c02eb74b" title="Use terse logging.">ArLog::Terse</a>, <span class="stringliteral">"gripperExample: Error: Robot does not have a gripper. Exiting."</span>);
    <a class="code" href="classAria.html#6abc3d39b3e9548063bb8e78375acc17" title="Shutdown all Aria processes/threads, call exit callbacks, and exit the program.">Aria::exit</a>(-1);
    <span class="keywordflow">return</span> -1;
  }

  <span class="comment">// Teleoperation actions with obstacle-collision avoidance</span>
  <a name="_a23"></a><a class="code" href="classArActionLimiterTableSensor.html" title="Action to limit speed (and stop) based on whether the &amp;quot;table&amp;quot;-sensors see...">ArActionLimiterTableSensor</a> tableLimit;
  robot.<a name="a24"></a><a class="code" href="classArRobot.html#9ab030786d423237d3e4aa06c0e9d8ce" title="Adds an action to the list with the given priority.">addAction</a>(&amp;tableLimit, 110);
  <a name="_a25"></a><a class="code" href="classArActionLimiterForwards.html" title="Action to limit the forwards motion of the robot based on range sensor readings.">ArActionLimiterForwards</a> limitNearAction(<span class="stringliteral">"near"</span>, 300, 600, 250);
  robot.<a class="code" href="classArRobot.html#9ab030786d423237d3e4aa06c0e9d8ce" title="Adds an action to the list with the given priority.">addAction</a>(&amp;limitNearAction, 100);
  <a class="code" href="classArActionLimiterForwards.html" title="Action to limit the forwards motion of the robot based on range sensor readings.">ArActionLimiterForwards</a> limitFarAction(<span class="stringliteral">"far"</span>, 300, 1100, 400);
  robot.<a class="code" href="classArRobot.html#9ab030786d423237d3e4aa06c0e9d8ce" title="Adds an action to the list with the given priority.">addAction</a>(&amp;limitFarAction, 90);
  <a name="_a26"></a><a class="code" href="classArActionLimiterBackwards.html" title="Action to limit the backwards motion of the robot based on range sensor readings...">ArActionLimiterBackwards</a> limitBackAction;
  robot.<a class="code" href="classArRobot.html#9ab030786d423237d3e4aa06c0e9d8ce" title="Adds an action to the list with the given priority.">addAction</a>(&amp;limitBackAction, 50);
  <a name="_a27"></a><a class="code" href="classArActionJoydrive.html" title="This action will use the joystick for input to drive the robot.">ArActionJoydrive</a> joydriveAction(<span class="stringliteral">"joydrive"</span>, 400, 15);
  robot.<a class="code" href="classArRobot.html#9ab030786d423237d3e4aa06c0e9d8ce" title="Adds an action to the list with the given priority.">addAction</a>(&amp;joydriveAction, 40);
  joydriveAction.setStopIfNoButtonPressed(<span class="keyword">false</span>);
  <a name="_a28"></a><a class="code" href="classArActionKeydrive.html" title="This action will use the keyboard arrow keys for input to drive the robot.">ArActionKeydrive</a> keydriveAction;
  robot.<a class="code" href="classArRobot.html#9ab030786d423237d3e4aa06c0e9d8ce" title="Adds an action to the list with the given priority.">addAction</a>(&amp;keydriveAction, 30);
  

  <span class="comment">// Handlers to control the gripper and print out info (classes defined above)</span>
  PrintGripStatus printStatus(&amp;gripper);
  GripperControlHandler gripControl(&amp;gripper);
  printStatus.addRobotTask(&amp;robot);
  gripControl.addKeyHandlers(&amp;robot);

  <span class="comment">// enable motors and run (if we lose connection to the robot, exit)</span>
  <a class="code" href="classArLog.html#43a8b3789126c818f390f24bdbceccce" title="Log a message, with formatting and variable number of arguments.">ArLog::log</a>(<a class="code" href="classArLog.html#c8cc0fb3aa323ab2a1c21340fdd1dce37040faf60eeb155eaa85d439b1066ca1" title="Use normal logging.">ArLog::Normal</a>, <span class="stringliteral">"You may now operate the robot with arrow keys or joystick. Operate the gripper with the u, d, o, c, and page up/page down keys."</span>);
  robot.<a name="a29"></a><a class="code" href="classArRobot.html#a3657bebab0086dd14ed0c8c3f76dc8b" title="Enables the motors on the robot.">enableMotors</a>();
  robot.<a name="a30"></a><a class="code" href="classArRobot.html#fb40bb581fa61eb08a542840e4264e26" title="Starts the instance to do processing in this thread.">run</a>(<span class="keyword">true</span>);
  
  <a class="code" href="classAria.html#6abc3d39b3e9548063bb8e78375acc17" title="Shutdown all Aria processes/threads, call exit callbacks, and exit the program.">Aria::exit</a>(0);
  <span class="keywordflow">return</span> 0;
}


</pre></div> </div>
<hr size="1"><address style="text-align: right;"><small>Generated on Wed Aug 1 12:22:50 2012 for Aria by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
