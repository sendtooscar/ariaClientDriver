<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Aria: soundsQueueExample.cpp</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="classes.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>soundsQueueExample.cpp</h1>This program demonstrates the sound output queue <a class="el" href="classArSoundsQueue.html" title="This class manages a queue of items to play as WAV files or as text to speak using...">ArSoundsQueue</a><p>
Shows how to operate the sounds queue and add WAV files to play.<p>
You may specify up to 10 file names on the command line. This example only demonstrates using the sounds queue for WAV file playback. For demonstration of using the sounds queue for speech synthesis, see the examples provided with either the ArSpeechSynth_Cepstral or ArSpeechSynth_Festival libraries.<p>
Usage: soundQueue <em>&lt;wav file names&gt;</em><p>
<div class="fragment"><pre class="fragment">
<span class="preprocessor">#include "Aria.h"</span>
<span class="preprocessor">#include "ariaTypedefs.h"</span>
<span class="preprocessor">#include "ariaUtil.h"</span>
<span class="preprocessor">#include "ArSoundsQueue.h"</span>
<span class="preprocessor">#include "ArSoundPlayer.h"</span>
<span class="preprocessor">#include &lt;iostream&gt;</span>
<span class="preprocessor">#include &lt;vector&gt;</span>

<span class="keyword">using namespace </span>std;

<span class="keywordtype">void</span> queueNowEmpty() {
  printf(<span class="stringliteral">"The sound queue is now empty.\n"</span>);
}

<span class="keywordtype">void</span> queueNowNonempty() {
  printf(<span class="stringliteral">"The sound queue is now non-empty.\n"</span>);
}

<span class="keywordtype">bool</span> no() {
  <span class="comment">// just a false tautology</span>
  <span class="keywordflow">return</span> <span class="keyword">false</span>;
}

<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv) {
  <a name="a0"></a><a class="code" href="classAria.html#d99c16b5d947229d9f8e1c5b2d4cdd73" title="Initialize Aria global data struture and perform OS-specific initialization, including...">Aria::init</a>();
  <span class="comment">//ArLog::init(ArLog::StdErr, ArLog::Verbose);</span>

  <span class="comment">// Create the sound queue.</span>
  <a name="_a1"></a><a class="code" href="classArSoundsQueue.html" title="This class manages a queue of items to play as WAV files or as text to speak using...">ArSoundsQueue</a> soundQueue;

  <span class="comment">// Set WAV file callbacks </span>
  soundQueue.<a name="a2"></a><a class="code" href="classArSoundsQueue.html#7a91b153f0bcf9705d9ab18091d32fe0">setPlayWavFileCallback</a>(<a name="a3"></a><a class="code" href="classArSoundPlayer.html#814d7e32962633f99ae5229c69502647">ArSoundPlayer::getPlayWavFileCallback</a>());
  soundQueue.<a name="a4"></a><a class="code" href="classArSoundsQueue.html#18a4ee9aaa952188792551ee9af2c2ae">setInterruptWavFileCallback</a>(<a name="a5"></a><a class="code" href="classArSoundPlayer.html#ce0317817d565d9328500bbe806eefac">ArSoundPlayer::getStopPlayingCallback</a>());

  <span class="comment">// Notifications when the queue goes empty or non-empty.</span>
  soundQueue.<a name="a6"></a><a class="code" href="classArSoundsQueue.html#bbc9d407d6e76c6a58bd1fc52941fb71">addQueueEmptyCallback</a>(<span class="keyword">new</span> <a name="_a7"></a><a class="code" href="classArGlobalFunctor.html" title="Functor for a global function with no parameters.">ArGlobalFunctor</a>(&amp;queueNowEmpty));
  soundQueue.<a name="a8"></a><a class="code" href="classArSoundsQueue.html#232be5d28fabf0dcbe95d34be0b8f261">addQueueNonemptyCallback</a>(<span class="keyword">new</span> <a class="code" href="classArGlobalFunctor.html" title="Functor for a global function with no parameters.">ArGlobalFunctor</a>(&amp;queueNowNonempty));

  <span class="comment">// Run the sound queue in a new thread</span>
  soundQueue.<a name="a9"></a><a class="code" href="classArSoundsQueue.html#d8f9600dba4c91cfc0418a011bf3f165" title="Begin processing the sounds queue in a background thread.">runAsync</a>();

  <span class="comment">// Get WAV file names from command line</span>
  <span class="keywordflow">if</span>(argc &lt; 2) 
  {
    cerr &lt;&lt; <span class="stringliteral">"Usage: "</span> &lt;&lt; argv[0] &lt;&lt; <span class="stringliteral">" &lt;up to ten WAV sound file names...&gt;\n"</span>;
    <a name="a10"></a><a class="code" href="classAria.html#6abc3d39b3e9548063bb8e78375acc17" title="Shutdown all Aria processes/threads, call exit callbacks, and exit the program.">Aria::exit</a>(-1);
  }
  std::vector&lt;const char*&gt; filenames;
  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 1; i &lt; min(argc, 11); i++) 
  {
    filenames.push_back(argv[i]);
  }

  <span class="comment">// This functor can be used to cancel all sound playback until removed</span>
  <a name="_a11"></a><a class="code" href="classArGlobalRetFunctor.html" title="Functor for a global function with return value.">ArGlobalRetFunctor&lt;bool&gt;</a> dontPlayItem(&amp;no);
  
  <span class="keywordflow">while</span>(<a name="a12"></a><a class="code" href="classAria.html#573c386c42739be20fa97a99ae65f9ee" title="Sees if Aria is still running (mostly for the thread in main).">Aria::getRunning</a>())
  {
    cout &lt;&lt; <span class="stringliteral">"Queue is "</span> &lt;&lt; 
      string(soundQueue.<a name="a13"></a><a class="code" href="classArSoundsQueue.html#55feaa97933ebf630f1373de06853684">isPaused</a>()?<span class="stringliteral">"paused"</span>:(soundQueue.<a name="a14"></a><a class="code" href="classArSoundsQueue.html#e75d363d5ff3da705f0c4f8d8c52dea8" title="Returns true if an item is currently being played.">isPlaying</a>()?<span class="stringliteral">"playing"</span>:<span class="stringliteral">"ready"</span>)) 
      &lt;&lt; <span class="stringliteral">", with "</span> &lt;&lt; soundQueue.<a name="a15"></a><a class="code" href="classArSoundsQueue.html#1503e852fae705e109a83ad8820f9fee" title="Get the current size of the speech/sound playback queue.">getCurrentQueueSize</a>() &lt;&lt; <span class="stringliteral">" pending sounds."</span> &lt;&lt; endl
      &lt;&lt; <span class="stringliteral">"Enter a command followed by the enter key:\n"</span>
      &lt;&lt; <span class="stringliteral">"\tp\trequest pause state (cumulative)\n"</span>
      &lt;&lt; <span class="stringliteral">"\tr\trequest resume state (cumulative)\n"</span> 
      &lt;&lt; <span class="stringliteral">"\ti\tinterrupt current sound\n"</span>
      &lt;&lt; <span class="stringliteral">"\tc\tclear the queue\n"</span>
      &lt;&lt; <span class="stringliteral">"\tC\tclear priority &lt; 4 from the queue.\n"</span>
      &lt;&lt; <span class="stringliteral">"\tn\tAdd "</span> &lt;&lt; filenames[0] &lt;&lt; <span class="stringliteral">" to the queue, but with a condition callback to prevent it playing.\n"</span>
      ;
    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0; i &lt; filenames.size(); i++)
      cout &lt;&lt; <span class="stringliteral">"\t"</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">"\tadd "</span> &lt;&lt; filenames[i] &lt;&lt; <span class="stringliteral">" to the queue\n"</span>;
    cout &lt;&lt; <span class="stringliteral">"\tq\tquit\n\n"</span>;

    <span class="keywordtype">int</span> c = getchar();
    <span class="keywordflow">if</span>(c == <span class="charliteral">'\n'</span>)
      <span class="keywordflow">continue</span>;
    <span class="keywordflow">switch</span>(c)
    {
      <span class="keywordflow">case</span> <span class="charliteral">'p'</span>: soundQueue.<a name="a16"></a><a class="code" href="classArSoundsQueue.html#7d27d8572c1db27e136a85ae15152d51">pause</a>(); <span class="keywordflow">break</span>;
      <span class="keywordflow">case</span> <span class="charliteral">'r'</span>: soundQueue.<a name="a17"></a><a class="code" href="classArSoundsQueue.html#2299817c9725d01073f92f06c0faf18d" title="Resume processing the sounds queue.">resume</a>(); <span class="keywordflow">break</span>;
      <span class="keywordflow">case</span> <span class="charliteral">'i'</span>: soundQueue.<a name="a18"></a><a class="code" href="classArSoundsQueue.html#0a24a9edf0dabfe72ff46a61ebced3a2" title="If sound is currently being played or speech is being spoken, interrupt it. (but...">interrupt</a>(); <span class="keywordflow">break</span>;
      <span class="keywordflow">case</span> <span class="charliteral">'q'</span>: soundQueue.<a name="a19"></a><a class="code" href="classArSoundsQueue.html#4ae132843ebaa7291a21063c582bdf8f">stop</a>(); <a name="a20"></a><a class="code" href="classArUtil.html#4dfb878a3f9123b8dd96ae05b2fd94cb" title="Sleep for the given number of milliseconds.">ArUtil::sleep</a>(100); <a class="code" href="classAria.html#6abc3d39b3e9548063bb8e78375acc17" title="Shutdown all Aria processes/threads, call exit callbacks, and exit the program.">Aria::exit</a>(0);
      <span class="keywordflow">case</span> <span class="charliteral">'c'</span>: soundQueue.<a name="a21"></a><a class="code" href="classArSoundsQueue.html#2e5eb64d85322adf020091d66cfe2cf1">clearQueue</a>(); <span class="keywordflow">break</span>;
      <span class="keywordflow">case</span> <span class="charliteral">'C'</span>: soundQueue.<a name="a22"></a><a class="code" href="classArSoundsQueue.html#2e8e700c60788cd59136a4c6af84d57b">removePendingItems</a>(4); <span class="keywordflow">break</span>;
      <span class="keywordflow">case</span> <span class="charliteral">'n'</span>: 
      {
        cout &lt;&lt; <span class="stringliteral">"Adding \""</span> &lt;&lt; filenames[0] &lt;&lt; <span class="stringliteral">"\" but with a condition callback that will prevent it from playing...\n"</span>;
        <a name="_a23"></a><a class="code" href="classArSoundsQueue_1_1Item.html">ArSoundsQueue::Item</a> item = soundQueue.<a name="a24"></a><a class="code" href="classArSoundsQueue.html#8a91d3b696ae76124ca0bd836bcc6136">createDefaultFileItem</a>(filenames[0]);
        item.<a name="a25"></a><a class="code" href="classArSoundsQueue_1_1Item.html#556bab0671b278f05dde0b4eaaa4b6b2">playbackConditionCallbacks</a>.push_back(&amp;dontPlayItem);
        soundQueue.<a name="a26"></a><a class="code" href="classArSoundsQueue.html#6c1813ed5c1b57c77b6f4d3f7c938988">addItem</a>(item);
        <span class="keywordflow">break</span>;
      }
      <span class="keywordflow">default</span>:
        <span class="keywordflow">if</span>(filenames.size() &gt; 0 &amp;&amp; c &gt;= <span class="charliteral">'0'</span> &amp;&amp; c &lt;= <span class="charliteral">'9'</span>)
        {
          <span class="keywordtype">size_t</span> i = c - <span class="charliteral">'0'</span>;
          <span class="keywordflow">if</span>(i &lt; filenames.size()) 
          {
            cout &lt;&lt; <span class="stringliteral">"Adding \""</span> &lt;&lt; filenames[i] &lt;&lt; <span class="stringliteral">"\" to the queue...\n"</span>; 
            soundQueue.<a name="a27"></a><a class="code" href="classArSoundsQueue.html#77f50ee7d294994b84a834bd307b634f">play</a>(filenames[i]);
          } 
        }
    }
  }
  cout &lt;&lt; <span class="stringliteral">"ended.\n"</span>;
  <a class="code" href="classAria.html#6abc3d39b3e9548063bb8e78375acc17" title="Shutdown all Aria processes/threads, call exit callbacks, and exit the program.">Aria::exit</a>(0);
  <span class="keywordflow">return</span> 0;
}


</pre></div> </div>
<hr size="1"><address style="text-align: right;"><small>Generated on Wed Aug 1 12:22:50 2012 for Aria by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
